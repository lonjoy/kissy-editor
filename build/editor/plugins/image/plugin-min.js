KISSY.Editor.add("image",function(d){d.addPlugin("image",function(){function l(a){var b=new r(a.target);a.halt();m(b)&&j.call("show",null,b)}var f=KISSY,c=f.Editor,s=f.UA,r=f.Node,n=f.Event,m=function(a){return a._4e_name()==="img"&&!/(^|\s+)ke_/.test(a[0].className)&&a},g={},k=c.Utils.addRes,t=c.Utils.destroyRes,j=d.addButton("image",{contentCls:"ke-toolbar-image",title:"\u63d2\u5165\u56fe\u7247",mode:c.WYSIWYG_MODE,offClick:function(){this.call("show")},_updateTip:function(a,b){var h=b.attr("_ke_saved_src")||b.attr("src");
a.html(h);a.attr("href",h)},show:function(a,b){this.editor.showDialog("image/dialog",[b])}});k.call(g,j,function(){d.destroyDialog("image/dialog")});n.on(d.document,"dblclick",l);k.call(g,function(){n.remove(d.document,"dblclick",l)});c.use("bubbleview",function(){c.BubbleView.register({pluginName:"image",pluginContext:j,editor:d,func:m,init:function(){var a=this,b=a.get("contentEl");b.html('\u56fe\u7247\u7f51\u5740\uff1a   <a class="ke-bubbleview-url" target="_blank" href="#"></a> -     <span class="ke-bubbleview-link ke-bubbleview-change">\u7f16\u8f91</span> -     <span class="ke-bubbleview-link ke-bubbleview-remove">\u5220\u9664</span>');
var h=b.one(".ke-bubbleview-url"),o=b.one(".ke-bubbleview-change"),p=b.one(".ke-bubbleview-remove");c.Utils.preventFocus(b);o.on("click",function(e){a._plugin.call("show",null,a._selectedEl);e.halt()});p.on("click",function(e){var q=a._plugin;if(s.webkit){var i=q.editor.getSelection().getRanges();i&&i[0]&&(i[0].collapse(true)||1)&&i[0].select()}a._selectedEl._4e_remove();a.hide();q.editor.notifySelectionChange();e.halt()});c.Utils.addRes.call(a,o,p);a.on("show",function(){var e=a._selectedEl;e&&a._plugin.call("_updateTip",
h,e)})}});k.call(g,function(){c.BubbleView.destroy("image")})});this.destroy=function(){t.call(g)}})},{attach:false});
