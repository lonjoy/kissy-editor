KISSY.Editor.add("font",function(e){e.addPlugin("font",function(){function C(a){for(var b=[],c=0;c<a.length;c++)b.push({name:a[c],value:a[c]});return b}var i=KISSY,g=i.Editor,p=g.Style,v=g.TripleButton,f=e.cfg.pluginConfig,j=f["font-size"],d,m,n,k=[];if(j!==false){j=j||{};i.mix(j,{items:C(["8px","10px","12px","14px","18px","24px","36px","48px","60px","72px","84px","96px"]),width:"55px"},false);var w={},x=[],h={element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]};
for(l=0;l<j.items.length;l++){d=j.items[l];m=d.name;n=d.attrs;d=d.value;w[d]=new p(h,{size:d});x.push({name:m,value:d,attrs:n})}f["font-size"]=j}h=f["font-family"];if(h!==false){h=h||{};i.mix(h,{items:[{name:"\u5b8b\u4f53",value:"SimSun"},{name:"\u9ed1\u4f53",value:"SimHei"},{name:"\u96b6\u4e66",value:"LiSu"},{name:"\u6977\u4f53",value:"KaiTi_GB2312"},{name:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{name:"Georgia",value:"Georgia"},{name:"Times New Roman",value:"Times New Roman"},{name:"Impact",value:"Impact"},{name:"Courier New",value:"Courier New"},
{name:"Arial",value:"Arial"},{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"}],width:"130px"},false);var y={},z=[],D={element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",attributes:{face:null}}]},l;f["font-family"]=h;for(l=0;l<h.items.length;l++){d=h.items[l];m=d.name;n=d.attrs||{};d=d.value;n.style=n.style||"";n.style+=";font-family:"+d;y[d]=new p(D,{family:d});z.push({name:m,value:d,attrs:n})}}m={click:function(a){var b=a.newVal;a=a.prevVal;var c=this.cfg.styles;
e.focus();e.fire("save");c=c[b];if(b==a){c.remove(e.document);this.btn.set("value","")}else c.apply(e.document);e.fire("save")},selectionChange:function(a){var b;a=a.path.elements;for(var c=this.cfg.styles,o=0;o<a.length;o++){b=a[o];for(var s in c)if(c.hasOwnProperty(s))if(c[s].checkElementRemovable(b,true)){this.btn.set("value",s);return}}s=this.name;var u,q;c=9999;var t="",r,A,B=this.cfg.items;for(o=0;o<a.length;o++){b=a[o];u=b.css(s).toLowerCase();for(b=0;b<B.length;b++){q=B[b];A=q.name.toLowerCase();
if((r=u.indexOf(A))>-1&&c>r){c=r;t=q.value}q.value.toLowerCase();if((r=u.indexOf(q.value))>-1&&c>r){c=r;t=q.value}}if(t){this.btn.set("value",t);return}}this.btn.reset("value")}};false!==f["font-size"]&&k.push(e.addSelect("font-size",i.mix({title:"\u5927\u5c0f",width:"30px",mode:g.WYSIWYG_MODE,showValue:true,popUpWidth:j.width,items:x,styles:w},m)));false!==f["font-family"]&&k.push(e.addSelect("font-family",i.mix({title:"\u5b57\u4f53",width:"110px",mode:g.WYSIWYG_MODE,popUpWidth:h.width,items:z,styles:y},m)));g={mode:g.WYSIWYG_MODE,
offClick:function(){var a=this.editor,b=this.cfg.style;a.fire("save");b.apply(a.document);a.fire("save");a.notifySelectionChange();a.focus()},onClick:function(){var a=this.editor,b=this.cfg.style;a.fire("save");b.remove(a.document);a.fire("save");a.notifySelectionChange();a.focus()},selectionChange:function(a){var b=this.btn;this.cfg.style.checkActive(a.path)?b.set("state",v.ON):b.set("state",v.OFF)}};false!==f["font-bold"]&&k.push(e.addButton("font-bold",i.mix({contentCls:"ke-toolbar-bold",title:"\u7c97\u4f53 ",
style:new p({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]})},g)));false!==f["font-italic"]&&k.push(e.addButton("font-italic",i.mix({contentCls:"ke-toolbar-italic",title:"\u659c\u4f53 ",style:new p({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]})},g)));false!==f["font-underline"]&&k.push(e.addButton("font-underline",i.mix({contentCls:"ke-toolbar-underline",title:"\u4e0b\u5212\u7ebf ",style:new p({element:"u",overrides:[{element:"span",
attributes:{style:"text-decoration: underline;"}}]})},g)));if(false!==f["font-strikeThrough"])k.push(e.addButton("font-underline",i.mix({contentCls:"ke-toolbar-strikeThrough",title:"\u5220\u9664\u7ebf ",style:new p((f["font-strikeThrough"]||{}).style||{element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"},{element:"strike"}]})},g)));this.destroy=function(){for(var a=0;a<k.length;a++)k[a].destroy()}})},{attach:false});
