KISSY.Editor.add("clipboard",function(n){var i=KISSY,j=i.Editor,l=i.Node,k=i.UA,q=j.Range,o=j.RANGE,r=i.Event;j.Paste||function(){function p(a){this.editor=a;this._init()}function s(a){if(!(!k.ie||a.document.compatMode=="BackCompat")){var c=a.getSelection(),d;if(c.getType()==t.SELECTION_ELEMENT&&(d=c.getSelectedElement())){var f=c.getRanges()[0],b=new l(a.document.createTextNode(""));b.insertBefore(d);f.setStartBefore(b);f.setEndAfter(d);c.selectRanges([f]);setTimeout(function(){if(d.parent()){b.remove();
c.selectElement(d)}},0)}}}i.augment(p,{_init:function(){var a=this.editor;r.on(a.document.body,k.ie?"beforepaste":"keydown",this._paste,this);a.addCommand("copy",new m("copy"));a.addCommand("cut",new m("cut"));a.addCommand("paste",new m("paste"))},_paste:function(a){if(!(a.type==="keydown"&&!(a.keyCode===86&&(a.ctrlKey||a.metaKey)))){i.log(a.type+" :  paste event happen");var c=this.editor,d=c.document;if(d.getElementById("ke_pastebin"))i.log(a.type+" : trigger twice ...");else{var f=c.getSelection();
a=new q(d);var b=new l(k.webkit?"<body></body>":"<div></div>",null,d);b.attr("id","ke_pastebin");k.webkit&&b[0].appendChild(d.createTextNode("\u00a0"));d.body.appendChild(b[0]);b.css({position:"absolute",top:f.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});b.css("left","-1000px");var g=f.createBookmarks();a.setStartAt(b,o.POSITION_AFTER_START);a.setEndAt(b,o.POSITION_BEFORE_END);a.select(true);setTimeout(function(){b._4e_remove();var e;b=k.webkit&&(e=b._4e_first())&&e.hasClass("Apple-style-span")?
e:b;f.selectBookmarks(g);e=b.html();i.log("paster "+e);if(e=i.trim(e.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){i.log("paster filter "+e);var h=c.fire("paste",{html:e,holder:b});if(h!==undefined)e=h;h=null;if(/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(e))h=c.htmlDataProcessor.wordFilter;c.insertHtml(e,h)}},0)}}}});j.Paste=p;var u=function(a,c){var d=a.document,f=new l(d.body),b=false,g=function(){b=true};f.on(c,g);(k.ie>7?d:d.selection.createRange()).execCommand(c);
f.detach(c,g);return b},v=k.ie?function(a,c){return u(a,c)}:function(a,c){try{return a.document.execCommand(c)}catch(d){return false}},w={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},m=function(a){this.type=a;this.canUndo=this.type=="cut"};m.prototype={exec:function(a){this.type=="cut"&&s(a);(a=v(a,this.type))||alert(w[this.type]);return a}};var t=j.Selection,x={copy:"\u590d\u5236",paste:"\u7c98\u8d34",
cut:"\u526a\u5207"};j.on("contextmenu",function(a){var c=a.contextmenu,d=c.cfg.editor,f=c.elDom,b={copy:0,cut:0,paste:0},g;for(g in b){if(!b.hasOwnProperty(g))break;b[g]=f.one(".ke-paste-"+g);(function(e){var h=b[e];if(!h){h=(new l("<a href='#'class='ke-paste-"+e+"'>"+x[e]+"</a>")).appendTo(f);h.on("click",function(y){y.halt();if(!h.hasClass("ke-menuitem-disable")){c.hide();setTimeout(function(){d.execCommand(e)},30)}})}b[e]=h})(g);a=b[g];(d.document.queryCommandEnabled(g)?true:false)?a.removeClass("ke-menuitem-disable"):
a.addClass("ke-menuitem-disable")}})}();n.ready(function(){new j.Paste(n)})},{attach:false});
