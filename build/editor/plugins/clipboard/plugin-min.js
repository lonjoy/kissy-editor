KISSY.Editor.add("clipboard",function(p){var h=KISSY,j=h.Editor,n=h.Node,i=h.UA,t=j.Range,q=j.RANGE,r=h.Event;j.Paste||function(){function s(a){this.editor=a;this._init()}function u(a){if(!(!i.ie||a.document.compatMode=="BackCompat")){var b=a.getSelection(),d;if(b.getType()==v.SELECTION_ELEMENT&&(d=b.getSelectedElement())){var g=b.getRanges()[0],e=new n(a.document.createTextNode(""));e.insertBefore(d);g.setStartBefore(e);g.setEndAfter(d);b.selectRanges([g]);setTimeout(function(){if(d.parent()){e.remove();
b.selectElement(d)}},0)}}}function w(a,b){m=1;var d=true;try{d=b.queryCommandEnabled(a)?true:false}catch(g){}m=0;return d}h.augment(s,{_init:function(){var a=this.editor;r.on(a.document.body,i.webkit?"paste":i.gecko?"paste":"beforepaste",this._paste,this);this._isPasting=false;r.on(a.document.body,"contextmenu",function(){m=1;setTimeout(function(){m=0},10)});a.addCommand("copy",new o("copy"));a.addCommand("cut",new o("cut"));a.addCommand("paste",new o("paste"))},_paste:function(a){if(!m){h.log(a.type+
" :  paste event happen");var b=this,d=b.editor,g=d.document;if(b._isPasting)h.log("paste tool fast , slow down please");else if(g.getElementById("ke_pastebin"))h.log(a.type+" : trigger twice ...");else{b._isPasting=true;var e=d.getSelection();a=new t(g);var c=new n(i.webkit?"<body></body>":"<div></div>",null,g);c.attr("id","ke_pastebin");i.webkit&&c[0].appendChild(g.createTextNode("\u00a0"));g.body.appendChild(c[0]);c.css({position:"absolute",top:e.getStartElement().offset().top+"px",width:"1px",height:"1px",
overflow:"hidden"});c.css("left","-1000px");var k=e.createBookmarks();a.setStartAt(c,q.POSITION_AFTER_START);a.setEndAt(c,q.POSITION_BEFORE_END);a.select(true);setTimeout(function(){c._4e_remove();var f;c=i.webkit&&(f=c._4e_first())&&f.hasClass("Apple-style-span")?f:c;e.selectBookmarks(k);f=c.html();if(f=h.trim(f.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){h.log("paster "+f);var l=d.fire("paste",{html:f,holder:c});if(l!==undefined)f=l;l=null;if(/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(f))l=
d.htmlDataProcessor.wordFilter;d.insertHtml(f,l);setTimeout(function(){b._isPasting=false},150)}},0)}}}});j.Paste=s;var x=function(a,b){var d=a.document,g=new n(d.body),e=false,c=function(){e=true};g.on(b,c);(i.ie>7?d:d.selection.createRange()).execCommand(b);g.detach(b,c);return e},y=i.ie?function(a,b){return x(a,b)}:function(a,b){try{return a.document.execCommand(b)}catch(d){return false}},z={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",
paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},o=function(a){this.type=a;this.canUndo=this.type=="cut"};o.prototype={exec:function(a){this.type=="cut"&&u(a);(a=y(a,this.type))||alert(z[this.type]);return a}};var v=j.Selection,A={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"},m;j.on("contextmenu",function(a){var b=a.contextmenu,d=b.cfg.editor,g=b.elDom,e={copy:0,cut:0,paste:0},c;for(c in e){if(!e.hasOwnProperty(c))break;e[c]=g.one(".ke-paste-"+c);(function(k){var f=e[k];if(!f){f=(new n("<a href='#'class='ke-paste-"+
k+"'>"+A[k]+"</a>")).appendTo(g);f.on("click",function(l){l.halt();if(!f.hasClass("ke-menuitem-disable")){b.hide();setTimeout(function(){d.execCommand(k)},30)}})}e[k]=f})(c);a=e[c];w(c,d.document)?a.removeClass("ke-menuitem-disable"):a.addClass("ke-menuitem-disable")}})}();p.ready(function(){new j.Paste(p)})},{attach:false});
