/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Sep 8 15:10
*/
KISSY.add("ajax/base",function(i,j,l,k){function b(h){h=i.mix(i.clone(u),h||{},undefined,undefined,true);if(!i.isBoolean(h.crossDomain)){var o=e.exec(h.url.toLowerCase());h.crossDomain=!!(o&&(o[1]!=r[1]||o[2]!=r[2]||(o[3]||(o[1]==="http:"?m:n))!=(r[3]||(r[1]==="http:"?m:n))))}if(h.processData&&h.data&&!i.isString(h.data))h.data=i.param(h.data,undefined,undefined,h.serializeArray);h.type=h.type.toUpperCase();h.hasContent=!q.test(h.type);if(!h.hasContent){if(h.data)h.url+=(/\?/.test(h.url)?"&":"?")+
h.data;if(h.cache===false)h.url+=(/\?/.test(h.url)?"&":"?")+"_ksTS="+(i.now()+"_"+i.guid())}h.dataType=i.trim(h.dataType||"*").split(d);h.context=h.context||h;return h}function a(h,o){f.fire(h,{ajaxConfig:o.config,xhr:o})}function c(h){var o=this.config;h=h.type;this.timeoutTimer&&clearTimeout(this.timeoutTimer);o[h]&&o[h].call(o.context,this.responseData,this.statusText,this);a(h,this)}function f(h){if(h.url){h=b(h);var o=new k(h);a("start",o);var x=new (t[h.dataType[0]]||t["*"])(o);o.transport=
x;h.contentType&&o.setRequestHeader("Content-Type",h.contentType);var v=h.dataType[0],w=h.accepts;o.setRequestHeader("Accept",v&&w[v]?w[v]+(v==="*"?"":", */*; q=0.01"):w["*"]);for(var y in h.headers)o.setRequestHeader(y,h.headers[y]);o.on("complete success error",c);o.readyState=1;a("send",o);if(h.async&&h.timeout>0)o.timeoutTimer=setTimeout(function(){o.abort("timeout")},h.timeout);try{o.state=1;x.send()}catch(z){o.status<2&&o.callback(-1,z)}return o}}var d=/\s+/,e=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,
g=function(h){return h},m=80,n=443,q=/^(?:GET|HEAD)$/,p,r;try{p=location.href}catch(s){p=document.createElement("a");p.href="";p=p.href}r=e.exec(p);p=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/.test(r[1]);var t={},u={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:true,serializeArray:true,processData:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:j.parse,
html:g,text:g,xml:i.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};u.converters.html=u.converters.text;i.mix(f,l.Target);i.mix(f,{isLocal:p,setupConfig:function(h){i.mix(u,h,undefined,undefined,true)},setupTransport:function(h,o){t[h]=o},getTransport:function(h){return t[h]},getConfig:function(){return u}});return f},{requires:["json","event","./xhrobject"]});
KISSY.add("ajax/form-serializer",function(i,j){var l=/^(?:select|textarea)/i,k=/\r?\n/g,b=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return{serialize:function(a){var c=[],f={};j.query(a).each(function(d){d=d.elements?i.makeArray(d.elements):[d];c.push.apply(c,d)});c=i.filter(c,function(d){return d.name&&!d.disabled&&(d.checked||l.test(d.nodeName)||b.test(d.type))});i.each(c,function(d){var e=j.val(d);e=i.map(i.makeArray(e),function(g){return g.replace(k,
"\r\n")});d=f[d.name]=f[d.name]||[];d.push.apply(d,e)});return i.param(f,undefined,undefined,false)}}},{requires:["dom"]});
KISSY.add("ajax/form",function(i,j,l,k){j.on("start",function(b){b=b.xhr.config;if(b.form){var a=l.get(b.form);if((a.encoding||a.enctype).toLowerCase()!="multipart/form-data"){if(a=k.serialize(a))if(b.hasContent){b.data=b.data||"";if(b.data)b.data+="&";b.data+=a}else b.url+=(/\?/.test(b.url)?"&":"?")+a}else{a=b.dataType[0];if(a=="*")a="text";b.dataType.length=2;b.dataType[0]="iframe";b.dataType[1]=a}}});return j},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-upload",function(i,j,l,k){function b(c){this.xhr=c}var a=document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(c){return c}}}});i.augment(b,{send:function(){var c=this.xhr,f=c.config,d,e=j.get(f.form);this.attrs={target:j.attr(e,"target")||"",action:j.attr(e,"action")||""};this.form=e;var g=i.guid("ajax-iframe");c.iframe=j.create("<iframe  id='"+g+"' name='"+g+"' style='position:absolute;left:-9999px;top:-9999px;'/>");c.iframeId=g;j.prepend(c.iframe,
a.body||a.documentElement);j.attr(e,{target:c.iframeId,action:f.url});if(f.data){d=f.data;f=f.serializeArray;d=i.unparam(d);g=[];for(var m in d)for(var n=i.isArray(d[m]),q=i.makeArray(d[m]),p=0;p<q.length;p++){var r=a.createElement("input");r.type="hidden";r.name=m+(n&&f?"[]":"");r.value=q[p];j.append(r,e);g.push(r)}d=g}this.fields=d;l.on(c.iframe,"load error",this._callback,this);e.submit()},_callback:function(c){var f=this.xhr;c=c.type;var d=f.iframe;if(d){j.attr(this.form,this.attrs);if(c=="load"){c=
d.contentWindow.document;f.responseXML=c;f.responseText=j.text(c.body);f.callback(200,"success")}else c=="error"&&f.callback(500,"error");j.remove(this.fields);l.detach(d);setTimeout(function(){j.remove(d)},30);f.iframe=null}},abort:function(){this._callback(0,1)}});k.setupTransport("iframe",b);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(i,j){j.setupConfig({jsonp:"callback",jsonpCallback:function(){return i.guid("jsonp")}});j.on("start",function(l){l=l.xhr;var k=l.config;if(k.dataType[0]=="jsonp"){var b,a=k.jsonpCallback,c=i.isFunction(a)?a():a,f=window[c];k.url+=(/\?/.test(k.url)?"&":"?")+k.jsonp+"="+c;window[c]=function(d){if(arguments.length>1)d=i.makeArray(arguments);b=[d]};l.on("complete",function(){window[c]=f;if(f===undefined)try{delete window[c]}catch(d){}else b&&f(b[0])});l.converters=l.converters||
{};l.converters.script=l.converters.script||{};l.converters.script.json=function(){return b[0]};k.dataType.length=2;k.dataType[0]="script";k.dataType[1]="json"}});return j},{requires:["./base"]});
KISSY.add("ajax/script",function(i,j){function l(b){if(!b.config.crossDomain&&!b.config.forceScript)return new (j.getTransport("*"))(b);this.xhrObj=b;return 0}var k=document;j.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(b){i.globalEval(b);return b}}}});i.augment(l,{send:function(){var b=this,a,c=this.xhrObj.config,f=k.head||k.getElementsByTagName("head")[0]||
k.documentElement;b.head=f;a=k.createElement("script");b.script=a;a.async="async";if(c.scriptCharset)a.charset=c.scriptCharset;a.src=c.url;a.onerror=a.onload=a.onreadystatechange=function(d){d=d||window.event;b._callback((d.type||"error").toLowerCase())};f.insertBefore(a,f.firstChild)},_callback:function(b,a){var c=this.script,f=this.xhrObj,d=this.head;if(c)if(a||!c.readyState||/loaded|complete/.test(c.readyState)||b=="error"){c.onerror=c.onload=c.onreadystatechange=null;d&&c.parentNode&&d.removeChild(c);
this.head=this.script=undefined;if(!a&&b!="error")f.callback(200,"success");else b=="error"&&f.callback(500,"scripterror")}},abort:function(){this._callback(0,1)}});j.setupTransport("script",l);return j},{requires:["./base","./xhr"]});
KISSY.add("ajax/xdr",function(i,j){function l(e,g,m){if(!d){d=true;e='<object id="'+a+'" type="application/x-shockwave-flash" data="'+e+'" width="0" height="0"><param name="movie" value="'+e+'" /><param name="FlashVars" value="yid='+g+"&uid="+m+'&host=KISSY.io" /><param name="allowScriptAccess" value="always" /></object>';g=f.createElement("div");f.body.appendChild(g);g.innerHTML=e}}function k(e){this.xhrObj=e}var b={},a="io_swf",c,f=document,d=false;i.augment(k,{send:function(){var e=this,g=e.xhrObj.config;
l((g.xdr||{}).src||i.Config.base+"ajax/io.swf",1,1);if(c){e._uid=i.guid();b[e._uid]=e;c.send(g.url,{id:e._uid,uid:e._uid,method:g.type,data:g.hasContent&&g.data||{}})}else setTimeout(function(){e.send()},200)},abort:function(){c.abort(this._uid)},_xdrResponse:function(e,g){var m,n=this.xhrObj;n.responseText=decodeURI(g.c.responseText);switch(e){case "success":m={status:200,statusText:"success"};delete b[g.id];break;case "abort":delete b[g.id];break;case "timeout":case "transport error":case "failure":delete b[g.id];
m={status:500,statusText:e}}m&&n.callback(m.status,m.statusText)}});j.applyTo=function(e,g,m){e=g.split(".");var n=i;i.each(e,function(q){n=n[q]});n.apply(null,m)};j.xdrReady=function(){c=f.getElementById(a)};j.xdrResponse=function(e,g,m){var n=b[g.uid];n&&n._xdrResponse(e,g,m)};i.io=j;return k},{requires:["./base"]});
KISSY.add("ajax/xhr",function(i,j,l){function k(){try{return new window.XMLHttpRequest}catch(f){}}var b=window.XDomainRequest;j.xhr=window.ActiveXObject?function(f){if(f&&b)return new b;if(!(f=!j.isLocal&&k()))a:{try{f=new window.ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}f=void 0}return f}:k;var a=j.xhr();if(a){var c=function(f){var d=f.config,e=d.xdr||{};if(d.crossDomain)if(!("withCredentials"in a)&&(String(e.use)==="flash"||!b))return new l(f);this.xhrObj=f};i.augment(c,{send:function(){var f=
this,d=f.xhrObj,e=d.config,g=j.xhr(e.crossDomain),m,n;f.xhr=g;e.username?g.open(e.type,e.url,e.async,e.username,e.password):g.open(e.type,e.url,e.async);if(m=e.xhrFields)for(n in m)g[n]=m[n];d.mimeType&&g.overrideMimeType&&g.overrideMimeType(d.mimeType);if(!e.crossDomain&&!d.requestHeaders["X-Requested-With"])d.requestHeaders["X-Requested-With"]="XMLHttpRequest";try{if(!e.crossDomain)for(n in d.requestHeaders)g.setRequestHeader(n,d.requestHeaders[n])}catch(q){}g.send(e.hasContent&&e.data||null);if(!e.async||
g.readyState==4)f._callback();else if(b&&g instanceof b){g.onload=function(){g.readyState=4;g.status=200;f._callback()};g.onerror=function(){g.readyState=4;g.status=500;f._callback()}}else g.onreadystatechange=function(){f._callback()}},abort:function(){this._callback(0,1)},_callback:function(f,d){try{var e=this.xhr,g=this.xhrObj,m=g.config;if(d||e.readyState==4){if(b&&e instanceof b){e.onerror=i.noop;e.onload=i.noop}else e.onreadystatechange=i.noop;if(d)e.readyState!==4&&e.abort();else{var n=e.status;
if(!(b&&e instanceof b))g.responseHeadersString=e.getAllResponseHeaders();var q=e.responseXML;if(q&&q.documentElement)g.responseXML=q;g.responseText=e.responseText;try{var p=e.statusText}catch(r){p=""}if(!n&&j.isLocal&&!m.crossDomain)n=g.responseText?200:404;else if(n===1223)n=204;g.callback(n,p)}}}catch(s){e.onreadystatechange=i.noop;d||g.callback(-1,s)}}});j.setupTransport("*",c);return j}},{requires:["./base","./xdr"]});
KISSY.add("ajax/xhrobject",function(i,j){function l(a){var c=a.responseText,f=a.responseXML,d=a.config,e=d.converters,g=a.converters||{},m,n,q=d.contents,p=d.dataType;if(c||f){for(d=a.mimeType||a.getResponseHeader("Content-Type");p[0]=="*";)p.shift();if(!p.length)for(m in q)if(q[m].test(d)){p[0]!=m&&p.unshift(m);break}p[0]=p[0]||"text";if(p[0]=="text"&&c!==undefined)n=c;else if(p[0]=="xml"&&f!==undefined)n=f;else i.each(["text","xml"],function(s){var t=p[0];if(g[s]&&g[s][t]||e[s]&&e[s][t]){p.unshift(s);
n=s=="text"?c:f;return false}})}q=p[0];for(d=1;d<p.length;d++){m=p[d];var r=g[q]&&g[q][m]||e[q]&&e[q][m];if(!r)throw"no covert for "+q+" => "+m;n=r(n);q=m}a.responseData=n}function k(a){i.mix(this,{responseData:null,config:a||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null})}var b=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;i.augment(k,j.Target,{setRequestHeader:function(a,c){this.requestHeaders[a]=
c;return this},getAllResponseHeaders:function(){return this.state===2?this.responseHeadersString:null},getResponseHeader:function(a){var c;if(this.state===2){if(!this.responseHeaders)for(this.responseHeaders={};c=b.exec(this.responseHeadersString);)this.responseHeaders[c[1]]=c[2];c=this.responseHeaders[a]}return c===undefined?null:c},overrideMimeType:function(a){if(!this.state)this.mimeType=a;return this},abort:function(a){a=a||"abort";this.transport&&this.transport.abort(a);this.callback(0,a);return this},
callback:function(a,c){if(this.state!=2){this.state=2;this.readyState=4;var f;if(a>=200&&a<300||a==304)if(a==304){c="notmodified";f=true}else try{l(this);c="success";f=true}catch(d){c="parsererror : "+d}else if(a<0)a=0;this.status=a;this.statusText=c;f?this.fire("success"):this.fire("error");this.fire("complete");this.transport=undefined}}});return k},{requires:["event"]});
KISSY.add("ajax",function(i,j,l){i.mix(l,{serialize:j.serialize,get:function(k,b,a,c,f){if(i.isFunction(b)){c=a;a=b;b=undefined}return l({type:f||"get",url:k,data:b,success:a,dataType:c})},post:function(k,b,a,c){if(i.isFunction(b)){c=a;a=b;b=undefined}return l.get(k,b,a,c,"post")},jsonp:function(k,b,a){if(i.isFunction(b)){a=b;b=undefined}return l.get(k,b,a,"jsonp")},getScript:i.getScript,getJSON:function(k,b,a){if(i.isFunction(b)){a=b;b=undefined}return l.get(k,b,a,"json")},upload:function(k,b,a,
c,f){if(i.isFunction(a)){f=c;c=a;a=undefined}return l({url:k,type:"post",dataType:f,form:b,data:a,success:c})}});return l},{requires:["ajax/form-serializer","ajax/base","ajax/xhrobject","ajax/xhr","ajax/script","ajax/jsonp","ajax/form","ajax/iframe-upload"]});
