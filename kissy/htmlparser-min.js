/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Sep 27 19:45
*/
KISSY.add("htmlparser/Parser",function(k,n,j){function g(f){this.lexer=f}function c(f){this.lexer=new j(f)}g.prototype={nextNode:function(){var f,i,o,q=this.lexer;if(f=q.nextNode())if(f.nodeType==1)if(f.isEndTag())return this.nextNode();else if(o=f.scanner){i=[];f=o.scan(f,q,i)}return f}};c.prototype={elements:function(){return new g(this.lexer)},parse:function(){for(var f=[],i,o=this.elements();i=o.nextNode();)f.push(i);return f}};return c},{requires:["./lexer/Cursor","./lexer/Lexer"]});
KISSY.add("htmlparser/Utils",function(){return{isLetter:function(k){return"a"<=k&&"z">=k||"A"<=k&&"Z">=k},isWhitespace:function(k){return/\s/.test(k)}}});
KISSY.add("htmlparser/dtd",function(k){k=k.merge;var n={isindex:1,fieldset:1},j={input:1,button:1,select:1,textarea:1,label:1},g=k({a:1},j),c=k({iframe:1},g),f={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},i={ins:1,del:1,script:1,style:1},o=k({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},i),q=k({sub:1,img:1,object:1,sup:1,
basefont:1,map:1,applet:1,font:1,big:1,small:1},o),s=k({p:1},q);j=k({iframe:1},q,j);q={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,
address:1,q:1,pre:1,p:1,em:1,dfn:1};var a=k({a:1},j),d={tr:1},b={"#":1},e=k({param:1},q),h=k({form:1},n,c,f,s),l={li:1},m={base:1,link:1,meta:1,title:1},p=k(m,{style:1,script:1}),r={head:1,body:1},t={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1};return{$nonBodyContent:k({html:1},r,m),$block:t,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:a,$body:k({script:1,style:1},t),
$cdata:{script:1,style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,
textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:r,head:p,style:b,body:h,base:{},link:{},meta:{},title:b,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:h,td:h,br:{},th:h,center:h,kbd:a,button:k(s,f),basefont:{},h5:a,h4:a,samp:a,h6:a,ol:l,h1:a,h3:a,option:b,h2:a,form:k(n,c,f,s),select:{optgroup:1,option:1},font:a,ins:a,menu:l,abbr:a,label:a,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:a,script:b,tfoot:d,cite:a,li:h,input:{},
iframe:h,strong:a,textarea:b,noframes:h,big:a,small:a,span:a,hr:{},dt:a,sub:a,optgroup:{option:1},param:{},bdo:a,"var":a,div:h,object:e,sup:a,dd:h,strike:a,area:{},dir:l,map:k({area:1,form:1,p:1},n,i,f),applet:e,dl:{dt:1,dd:1},del:a,isindex:{},fieldset:k({legend:1},q),thead:d,ul:l,acronym:a,b:a,a:j,blockquote:h,caption:a,i:a,u:a,tbody:d,s:a,address:k(c,s),tt:a,legend:a,q:a,pre:k(o,g),p:a,em:a,dfn:a}});
KISSY.add("htmlparser/lexer/Cursor",function(){function k(n){this.position=n||0}k.prototype={advance:function(){this.position++},retreat:function(){this.position=Math.max(--this.position,0)}};return k});
KISSY.add("htmlparser/lexer/Index",function(){function k(){this.lineCursors=[]}function n(g,c){for(var f=0;f<g.length;f++)if(g[f].position===c.position)return f;return-1}function j(g,c){for(var f=0;f<g.length;f++)if(g[f].position>c.position)break;return f}k.prototype={add:function(g){n(this.lineCursors,g)==-1&&this.lineCursors.splice(j(this.lineCursors,g),0,g)},remove:function(g){var c=this.lineCursors;g=n(this.lineCursors,g);g!=-1&&c.splice(g,1)},row:function(g){return j(this.lineCursors,g)-1},col:function(g){var c=
j(this.lineCursors,g)-1;return g.position-this.lineCursors[c]}};return k});
KISSY.add("htmlparser/lexer/Lexer",function(k,n,j,g,c,f,i,o,q){function s(a){this.page=new j(a);this.cursor=new n;this.nodeFactory=this}s.prototype={setPosition:function(a){this.cursor.position=a},getPosition:function(){return this.cursor.position},nextNode:function(a){var d,b,e=this.cursor,h=this.page;d=e.position;b=h.getChar(e);switch(b){case -1:a=null;break;case "<":b=h.getChar(e);if(b==-1)a=this.makeString(d,e.position);else if(b=="/"||f.isLetter(b)){h.ungetChar(e);a=this.parseTag(d)}else if("!"==
b){b=h.getChar(e);if(b==-1)a=this.makeString(d,e.position);else if(">"==b)a=this.makeComment(d,e.position);else{h.ungetChar(e);if("-"==b)a=this.parseComment(d,a);else{h.ungetChar(e);a=this.parseTag(d)}}}else{h.ungetChar(e);a=this.parseString(d,a)}break;default:h.ungetChar(e);a=this.parseString(d,a)}return a},makeComment:function(a,d){var b;b=d-a;if(0!=b){if(2>b)return this.makeString(a,d);b=this.nodeFactory.createCommentNode(this.page,a,d)}else b=null;return b},makeString:function(a,d){var b=null;
if(d-a>0)b=this.nodeFactory.createStringNode(this.page,a,d);return b},makeCData:function(a,d){var b=null;if(d-a>0)b=this.nodeFactory.createCDataNode(this.page,a,d);return b},makeTag:function(a,d,b){var e;e=d-a;if(0!=e){if(2>e)return this.makeString(a,d);a=this.nodeFactory.createTagNode(this.page,a,d,b)}else a=null;return a},createTagNode:function(a,d,b,e){return new o(a,d,b,e)},createStringNode:function(a,d,b){return new g(a,d,b)},createCDataNode:function(a,d,b){return new c(a,d,b)},createCommentNode:function(a,
d,b){return new q(a,d,b)},parseTag:function(a){var d,b=[],e=[],h,l=this.page,m=0,p=this.cursor;for(b[0]=p.position;!d;){b[m+1]=p.position;h=l.getChar(p);switch(m){case 0:if(h==-1||">"==h||"<"==h){if("<"==h){l.ungetChar(p);b[m+1]=p.position}d=true}else f.isWhitespace(h)||(m=1);break;case 1:if(-1==h||">"==h||"<"==h){if("<"==h){l.ungetChar(p);b[m+1]=p.getPosition}this.standalone(e,b);d=true}else if(f.isWhitespace(h)){b[6]=b[2];m=6}else if("="==h)m=2;break;case 2:if(-1==h||">"==h){this.standalone(e,b);
d=true}else if("'"==h){m=4;b[4]=b[3]}else if('"'==h){m=5;b[5]=b[3]}else f.isWhitespace(h)||(m=3);break;case 3:if(-1==h||">"==h){this.naked(e,b);d=true}else if(f.isWhitespace(h)){this.naked(e,b);b[0]=b[4];m=0}break;case 4:if(-1==h){this.single_quote(e,b);d=true}else if("'"==h){this.single_quote(e,b);b[0]=b[5]+1;m=0}break;case 5:if(-1==h){this.double_quote(e,b);d=true}else if('"'==h){this.double_quote(e,b);b[0]=b[6]+1;m=0}break;case 6:if(-1==h){this.standalone(e,b);b[0]=b[6];l.ungetChar(p);m=0}else if(!f.isWhitespace(h))if("="==
h){b[2]=b[6];b[3]=b[7];m=2}else{this.standalone(e,b);b[0]=b[6];l.ungetChar(p);m=0}break;default:throw Error("how ** did we get in state "+m);}}return this.makeTag(a,p.position,e)},parseComment:function(a,d){var b,e,h=this.page,l=this.cursor,m;b=false;for(m=0;!b;){e=h.getChar(l);if(-1==e)b=true;else switch(m){case 0:if(">"==e)b=true;if("-"==e)m=1;else return this.parseString(a,d);break;case 1:if("-"==e){e=h.getChar(l);if(-1==e)b=true;else if(">"==e)b=true;else{h.ungetChar(l);m=2}}else return this.parseString(a,
d);break;case 2:if("-"==e)m=3;else if(-1==e)return this.parseString(a,d);break;case 3:m="-"==e?4:2;break;case 4:if(">"==e)b=true;else f.isWhitespace(e)||(m=2);break;default:throw Error("how ** did we get in state "+m);}}return this.makeComment(a,l.position)},parseString:function(a,d){for(var b=0,e,h=this.page,l=this.cursor,m=0;!b;){e=h.getChar(l);if(-1==e)b=1;else if(d&&0==m&&("'"==e||'"'==e))m=e;else if(d&&0!=m&&"\\"==e){e=h.getChar(l);-1!=e&&"\\"!=e&&e!=m&&h.ungetChar(l)}else if(d&&e==m)m=0;else if(d&&
0==m&&e=="/"){e=h.getChar(l);if(-1==e)b=1;else if("/"==e){do e=h.getChar(l);while(-1!=e&&"\n"!=e)}else if("*"==e){do{do e=h.getChar(l);while(-1!=e&&"*"!=e);e=h.getChar(l);e=="*"&&h.ungetChar(l)}while(-1!=e&&"/"!=e)}else h.ungetChar(l)}else if(0==m&&"<"==e){e=h.getChar(l);if(-1==e)b=1;else{if("/"==e||f.isLetter(e)||"!"==e){b=1;h.ungetChar(l)}h.ungetChar(l)}}}return this.makeString(a,l.position)},parseCDATA:function(a){var d,b,e,h,l,m,p=this.cursor,r=this.page;d=p.position;b=0;e=false;h="";for(m=false;!e;){l=
r.getChar(p);switch(b){case 0:switch(l){case -1:e=true;break;case "'":if(a&&!m)if(""==h)h="'";else if("'"==h)h="";break;case '"':if(a&&!m)if(""==h)h='"';else if('"'==h)h="";break;case "\\":if(a)if(""!=h){l=r.getChar(p);if(-1==l)e=true;else l!="\\"&&l!=h&&r.ungetChar(p)}break;case "/":if(a)if(""==h){l=r.getChar(p);if(-1==l)e=true;else if("/"==l)m=true;else if("*"==l){do{do l=r.getChar(p);while(-1!=l&&"*"!=l);l=r.getChar(p);l=="*"&&r.ungetChar(p)}while(-1!=l&&"/"!=l)}else r.ungetChar(p)}break;case "\n":m=
false;break;case "<":if(a){if(""==h)b=1}else b=1}break;case 1:switch(l){case -1:e=true;break;case "/":b=2;break;case "!":l=r.getChar(p);if(-1==l)e=true;else if("-"==l){l=r.getChar(p);if(-1==l)e=true;else b="-"==l?3:0}else b=0;break;default:b=0}break;case 2:m=false;if(-1==l)e=true;else if(f.isLetter(l)){e=true;r.ungetChar(p);r.ungetChar(p);r.ungetChar(p)}else b=0;break;case 3:m=false;if(-1==l)e=true;else if("-"==l){l=r.getChar(p);if(-1==l)e=true;else if("-"==l){l=r.getChar(p);if(-1==l)e=true;else if(">"==
l)b=0;else{r.ungetChar(p);r.ungetChar(p)}}else r.ungetChar(p)}break;default:throw Error("unexpected "+b);}}return this.makeCData(d,p.position)},single_quote:function(a,d){var b=this.page;a.push(new i(b.getText(d[1],d[2]),"=",b.getText(d[4]+1,d[5]),"'"))},double_quote:function(a,d){var b=this.page;a.push(new i(b.getText(d[1],d[2]),"=",b.getText(d[5]+1,d[6]),'"'))},standalone:function(a,d){a.push(new i(this.page.getText(d[1],d[2])))},naked:function(a,d){var b=this.page;a.push(new i(b.getText(d[1],d[2]),
"=",b.getText(d[3],d[4])))}};return s},{requires:["./Cursor","./Page","../nodes/Text","../nodes/CData","../Utils","../nodes/Attribute","../nodes/Tag","../nodes/Comment"]});
KISSY.add("htmlparser/lexer/Page",function(k,n){function j(g){this.source=g;this.lineIndex=new n}j.prototype={getChar:function(g){var c=this.source,f=g.position;if(f>=c.length)return-1;var i=c.charAt(f);g.advance();if("\r"===i){i="\n";f=g.position;c.charAt(f)==="\n"&&g.advance()}"\n"===i&&this.lineIndex.add(g);return i},ungetChar:function(g){var c=this.source;g.retreat();var f=g.position,i=c.charAt(f);if(i==="\n"&&0!=f){i=c.charAt(f-1);"\r"===i&&g.retreat()}},getText:function(g,c){return this.source.slice(g,
c)},row:function(g){return this.lineIndex.row(g)},col:function(g){return this.lineIndex.col(g)}};return j},{requires:["./Index"]});KISSY.add("htmlparser/nodes/Attribute",function(){return function(k,n,j,g){this.nodeType=2;this.name=k;this.assignMent=n;this.value=j;this.quote=g}});
KISSY.add("htmlparser/nodes/CData",function(k,n){function j(){j.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}k.extend(j,n,{writeHtml:function(g,c){var f=this.toHtml();c.onCData(this)!==false&&g.cdata(f)}});return j},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Comment",function(k,n){function j(){j.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}k.extend(j,n,{writeHtml:function(g,c){var f=this.toHtml();c.onComment(this)!==false&&g.comment(f)}});return j},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Node",function(k){function n(j,g,c){this.parentNode=null;this.page=j;this.startPosition=g;this.endPosition=c;this.nextSibling=this.previousSibling=this.nodeName=null;if(k.Config.debug)this.toHtmlContent=this.toHtml()}n.prototype={toHtml:function(){if(this.page)return this.page.getText(this.startPosition,this.endPosition)},toString:function(){var j=[];j.push(this.nodeName+"  ["+this.startPosition+":"+this.endPosition+"]\n");j.push(this.toHtml());return j.join("")}};return n});
KISSY.add("htmlparser/nodes/Tag",function(k,n,j,g,c,f){function i(a,d,b,e){i.superclass.constructor.apply(this,arguments);this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=e||[];this.nodeType=1;e=this.attributes;if(e[0]){this.nodeName=e[0].name.toLowerCase();this.tagName=this.nodeName.replace(/\//,"");this.isEmptyXmlTag=/\/$/.test(this.nodeName);e.splice(0,1)}if(!this.isEmptyXmlTag){var h=e[e.length-1];if(this.isEmptyXmlTag=!!(h&&/\/$/.test(h.name)))e.length-=1}this.closed=this.isEmptyXmlTag;
this.closedEndPosition=this.closedStartPosition=-1;this.scanner=s[this.nodeName]||j}function o(a){var d=a.childNodes;a.firstChild=d[0];a.lastChild=d[d.length-1];if(d.length>=1){d[0].nextSibling=d[0].nextSibling=null;d[0].parentNode=a}if(d.length>1){for(var b=0;b<d.length-1;b++){d[b].nextSibling=d[b+1];d[b+1].previousSibling=d[b];d[b+1].parentNode=a}d[d.length-1].nextSibling=null}}function q(a,d){for(var b=0;b<a.length;b++)if(a[b].name==d)return a[b];return null}var s={style:g,script:g,textarea:c};
k.extend(i,n,{isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(a){this.childNodes.push(a);o(this)},insertBefore:function(a){var d=a.parentNode.childNodes,b=k.indexOf(a,d);d.splice(b,0,this);o(a.parentNode)},removeChild:function(a){var d=a.parentNode.childNodes,b=k.indexOf(a,d);d.splice(b,1);o(a.parentNode)},getAttribute:function(a){return(a=q(this.attributes,a))&&a.value},setAttribute:function(a,d){var b=q(this.attributes,a);if(b)b.value=d;else this.attributes.push(new f(a,
"=",d,'"'))},removeAttribute:function(a){(a=q(this.attributes,a))&&this.attributes.splice(k.indexOf(a,this.attributes),1)},writeHtml:function(a,d){var b=this,e;e=b.tagName;if(d){if(!(e=d.onTagName(e)))return;b.tagName=e;e=d.onTag(b);if(e===false)return;if(e)b=e;if(b.nodeType!==1){b.writeHtml(a,d);return}if(!b.tagName){k.each(b.childNodes,function(p){p.writeHtml(a,d)});return}}a.openTag(b);for(var h=b.attributes,l=0;l<h.length;l++){var m=h[l];e=m.name;if(d){if(!(e=d.onAttributeName(e)))continue;if(d.onAttribute(m)===
false)continue}a.attribute(m)}a.openTagClose(b);if(!b.isEmptyXmlTag){k.each(b.childNodes,function(p){p.writeHtml(a,d)});a.closeTag(b)}}});return i},{requires:["./Node","../scanners/TagScanner","../scanners/QuoteCdataScanner","../scanners/TextareaScanner","./Attribute"]});
KISSY.add("htmlparser/nodes/Text",function(k,n){function j(){j.superclass.constructor.apply(this,arguments);this.nodeType=3;this.nodeName="#text"}k.extend(j,n,{writeHtml:function(g,c){var f=this.toHtml();c.onText(this)!==false&&g.text(f)}});return j},{requires:["./Node"]});
KISSY.add("htmlparser/scanners/CdataScanner",function(){return{scan:function(k,n,j,g){j=n.parseCDATA(g);g=n.getPosition();var c=n.nextNode();if(c)if(c.nodeType!=1||!(c.isEndTag()&&c.tagName==k.tagName))n.setPosition(g);k.closed=true;j&&k.appendChild(j);return k}}});KISSY.add("htmlparser/scanners/QuoteCdataScanner",function(k,n){return{scan:function(j,g,c){return n.scan(j,g,c,true)}}},{requires:["./CdataScanner"]});
KISSY.add("htmlparser/scanners/TagScanner",function(k,n){var j={scan:function(g,c,f){var i,o;if(!g.isEmptyXmlTag){do{if(i=c.nextNode())if(i.nodeType===1)if(i.isEndTag()&&i.tagName==g.tagName){g.closed=true;i=null}else if(!i.isEndTag()&&!this.canHasNodeAsChild(g,i)){c.setPosition(i.startPosition);i=null}else if(i.isEndTag()){var q=-1;for(o=f.length-1;o>=0;o--){var s=f[o];if(s.tagName===i.tagName){q=o;break}else if(!this.canHasNodeAsChild(s,i)){q=o;break}}if(q!=-1){g.closed=true;f[f.length-1].appendChild(g);
for(o=f.length-1;o>q;o--){g=f[o];i=f[o-1];g.closed=true;i.appendChild(g)}g=f[q];f.length=q;i=null}}else if(o=i.scanner)if(o===j)if(i.isEmptyXmlTag)g.appendChild(i);else{f.push(g);g=i}else{i=o.scan(i,c,f);g.appendChild(i)}else g.appendChild(i);else g.appendChild(i);if(i==null)if(f.length>0){i=f[f.length-1];if(i.nodeType==1)if(i.scanner===j){f.length-=1;g.closed=true;i.appendChild(g);g=i}else i=null;else i=null}}while(i)}g.closed=true;return g},canHasNodeAsChild:function(g,c){return!!n[g.tagName][c.tagName]}};
return j},{requires:["../dtd"]});KISSY.add("htmlparser/scanners/TextareaScanner",function(k,n){return{scan:function(j,g,c){return n.scan(j,g,c,false)}}},{requires:["./CdataScanner"]});
KISSY.add("htmlparser/writer/basic",function(k){function n(){this.output=[]}n.prototype={append:function(){for(var j=this.output,g=arguments,c,f=0;f<g.length;f++){c=g[f];if(c.length>1)for(var i=0;i<c.length;i++)j.push(c.charAt(i));else j.push(c)}return this},openTag:function(j){this.append("<",j.tagName)},openTagClose:function(j){j.isEmptyXmlTag&&this.append(" ","/");this.append(">")},closeTag:function(j){this.append("</",j.tagName,">")},attribute:function(j){this.append(" ",j.name,'="',k.escapeHTML(j.value||
j.name),'"')},text:function(j){this.append(j)},cdata:function(j){this.append(j)},comment:function(j){this.append(j)},getHtml:function(){return this.output.join("")}};return n});
KISSY.add("htmlparser/writer/beautify",function(k,n,j){function g(){g.superclass.constructor.apply(this,arguments);this.inPre=0;this.indentChar="\t";this.allowIndent=this.indentLevel=0;this.rules={};for(var c in k.merge(j.$nonBodyContent,j.$block,j.$listItem,j.$tableContent))this.setRules(c,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("br",{breakAfterOpen:1});this.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});this.setRules("style",
{allowIndent:0,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("script",{allowIndent:0,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("pre",{allowIndent:0})}k.extend(g,n,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var c=this.output;if(!this.inPre&&c.length){for(var f=c.length-1;f>=0;f--)if(!/[\r\n\t ]/.test(c[f]))break;c.length=
f+1;this.append("\n")}this.allowIndent=1},setRules:function(c,f){this.rules[c]||(this.rules[c]={});k.mix(this.rules[c],f)},openTag:function(c){var f=this.rules[c.tagName]||{};if(this.allowIndent)this.indentation();else if(f.breakBeforeOpen){this.lineBreak();this.indentation()}g.superclass.openTag.apply(this,arguments)},openTagClose:function(c){var f=c.tagName,i=this.rules[f]||{};if(c.isEmptyXmlTag)this.append(" />");else{this.append(">");i.allowIndent&&this.indentLevel++}i.breakAfterOpen&&this.lineBreak();
if(f==="pre")this.inPre=1},closeTag:function(c){var f=c.tagName,i=this.rules[f]||{};i.allowIndent&&this.indentLevel--;if(this.allowIndent)this.indentation();else if(i.breakBeforeClose){this.lineBreak();this.indentation()}g.superclass.closeTag.apply(this,arguments);if(f==="pre")this.inPre=0;i.breakAfterClose&&this.lineBreak()},text:function(c){this.allowIndent&&this.indentation();this.inPre||(c=c.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));this.append(c)},comment:function(c){this.allowIndent&&this.indentation();
this.append(c)}});return g},{requires:["./basic","../dtd"]});
KISSY.add("htmlparser/writer/filter",function(k){function n(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comments=[];this.texts=[];this.cdatas=[];this.attributes=[]}function j(c,f){for(var i=0;i<c.length;i++)k.each(c[i].value,function(o){f=f.replace(o[0],o[1])});return f}function g(c,f,i){for(var o=0;o<c.length;o++)if(c[o].value.apply(null,f)===false)return false;return i}n.prototype={addRules:function(c,f){f=f||10;for(var i in c){var o=this[i],q;a:{for(q=0;q<o.length;q++)if(o[q].priority>
f){q=q;break a}q=o.length}o.splice(q,0,{value:c[i],priority:f})}},onTagName:function(c){return j(this.tagNames,c)},onAttributeName:function(c){return j(this.attributeNames,c)},onText:function(c){return g(this.texts,[c.toHtml(),c],c)},onCData:function(c){return g(this.cdatas,[c.toHtml(),c],c)},onAttribute:function(c,f){return g(this.attributes,[f,c],f)},onComment:function(c){return g(this.comments,[c.toHtml(),c],c)},onNode:function(c){var f=c.nodeType;if(f===1)return this.onTag(c);else if(f===3)return this.onText(c.toHtml(),
c);else if(f===8)return this.onComment(c.toHtml(),c)},onTag:function(c){for(var f=["^",c.tagName,"$"],i=this.tags,o,q=0;q<f.length;q++)for(var s=f[q],a=0;a<i.length;a++){var d=i[a].value;if(d[s]){if((o=d[s](c))===false)return false;if(o&&o!=d)return this.onNode(o);if(!c.name)return c}}return c}};return n});
KISSY.add("htmlparser",function(k,n,j,g,c,f){return{Lexer:n,Parser:j,BasicWriter:g,BeautifyWriter:c,Filter:f}},{requires:["htmlparser/lexer/Lexer","htmlparser/Parser","htmlparser/writer/basic","htmlparser/writer/beautify","htmlparser/writer/filter"]});
