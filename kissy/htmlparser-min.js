/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Nov 18 17:23
*/
KISSY.add("htmlparser/Parser",function(i,m,n){function f(d,l){this.lexer=d;this.opts=l}function g(d,l){this.lexer=new n(d);this.opts=l||{}}f.prototype={nextNode:function(){var d,l,k,q=this.lexer;if(d=q.nextNode())if(d.nodeType==1)if(d.isEndTag())return this.nextNode();else if(k=d.scanner){l=[];d=k.scan(d,q,l,this.opts)}return d}};g.prototype={elements:function(){return new f(this.lexer,this.opts)},parse:function(){for(var d=[],l,k=this.elements();l=k.nextNode();)d.push(l);return d}};return g},{requires:["./lexer/Cursor",
"./lexer/Lexer"]});KISSY.add("htmlparser/Utils",function(){return{collapseWhitespace:function(i){return i.replace(/[\s\xa0]+/g," ")},isLetter:function(i){return"a"<=i&&"z">=i||"A"<=i&&"Z">=i},isWhitespace:function(i){return/^[\s\xa0]$/.test(i)}}});
KISSY.add("htmlparser/dtd",function(i){i=i.merge;var m={isindex:1,fieldset:1},n={input:1,button:1,select:1,textarea:1,label:1},f=i({a:1},n),g=i({iframe:1},f),d={hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1},l={ins:1,del:1,script:1,style:1},k=i({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1},l),q=i({sub:1,img:1,object:1,sup:1,
basefont:1,map:1,applet:1,font:1,big:1,small:1},k),p=i({p:1},q);n=i({iframe:1},q,n);q={img:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,
address:1,q:1,pre:1,p:1,em:1,dfn:1};var e=i({a:1},n),c={tr:1},a={"#":1},b=i({param:1},q),h=i({form:1},m,g,d,p),o={li:1},j={base:1,link:1,meta:1,title:1},s=i(j,{style:1,script:1}),r={head:1,body:1},t={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},v={$nonBodyContent:i({html:1},r,j),$block:t,$blockLimit:{body:1,div:1,td:1,th:1,caption:1,form:1},$inline:e,$body:i({script:1,style:1},t),$cdata:{script:1,
style:1},$empty:{area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},$listItem:{dd:1,dt:1,li:1},$list:{ul:1,ol:1,dl:1},$nonEditable:{applet:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,script:1,textarea:1,param:1},$removeEmpty:{abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},
$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},html:r,head:s,style:a,body:h,base:{},link:{},meta:{},title:a,col:{},tr:{td:1,th:1},img:{},colgroup:{col:1},noscript:h,td:h,br:{},th:h,center:h,kbd:e,button:i(p,d),basefont:{},h5:e,h4:e,samp:e,h6:e,ol:o,h1:e,h3:e,option:a,h2:e,form:i(m,g,d,p),select:{optgroup:1,option:1},font:e,ins:e,menu:o,abbr:e,label:e,table:{thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1},code:e,script:a,tfoot:c,cite:e,li:h,input:{},iframe:h,
strong:e,textarea:a,noframes:h,big:e,small:e,span:e,hr:{},dt:e,sub:e,optgroup:{option:1},param:{},bdo:e,"var":e,div:h,object:b,sup:e,dd:h,strike:e,area:{},dir:o,map:i({area:1,form:1,p:1},m,l,d),applet:b,dl:{dt:1,dd:1},del:e,isindex:{},fieldset:i({legend:1},q),thead:c,ul:o,acronym:e,b:e,a:n,blockquote:h,caption:e,i:e,u:e,tbody:c,s:e,address:i(g,p),tt:e,legend:e,q:e,pre:i(k,f),p:e,em:e,dfn:e};(function(){var u,w=["article","figure","nav","aside","section","footer"],x;for(x in v)for(var y in v[x])if(y==
"div")for(u=0;u<w.length;u++)v[x][w[u]]=v[x][y];for(u=0;u<w.length;u++)v[w[u]]=v.div})();return v});KISSY.add("htmlparser/lexer/Cursor",function(){function i(m){this.position=m||0}i.prototype={advance:function(){this.position++},retreat:function(){this.position=Math.max(--this.position,0)}};return i});
KISSY.add("htmlparser/lexer/Index",function(){function i(){this.lineCursors=[]}function m(f,g){for(var d=0;d<f.length;d++)if(f[d].position===g.position)return d;return-1}function n(f,g){for(var d=0;d<f.length;d++)if(f[d].position>g.position)break;return d}i.prototype={add:function(f){m(this.lineCursors,f)==-1&&this.lineCursors.splice(n(this.lineCursors,f),0,f)},remove:function(f){var g=this.lineCursors;f=m(this.lineCursors,f);f!=-1&&g.splice(f,1)},row:function(f){return n(this.lineCursors,f)-1},col:function(f){var g=
n(this.lineCursors,f)-1;return f.position-this.lineCursors[g]}};return i});
KISSY.add("htmlparser/lexer/Lexer",function(i,m,n,f,g,d,l,k,q){function p(e){this.page=new n(e);this.cursor=new m;this.nodeFactory=this}p.prototype={setPosition:function(e){this.cursor.position=e},getPosition:function(){return this.cursor.position},nextNode:function(e){var c,a,b=this.cursor,h=this.page;c=b.position;a=h.getChar(b);switch(a){case -1:e=null;break;case "<":a=h.getChar(b);if(a==-1)e=this.makeString(c,b.position);else if(a=="/"||d.isLetter(a)){h.ungetChar(b);e=this.parseTag(c)}else if("!"==
a){a=h.getChar(b);if(a==-1)e=this.makeString(c,b.position);else if(">"==a)e=this.makeComment(c,b.position);else{h.ungetChar(b);if("-"==a)e=this.parseComment(c,e);else{h.ungetChar(b);e=this.parseTag(c)}}}else{h.ungetChar(b);e=this.parseString(c,e)}break;default:h.ungetChar(b);e=this.parseString(c,e)}return e},makeComment:function(e,c){var a;a=c-e;if(0!=a){if(2>a)return this.makeString(e,c);a=this.nodeFactory.createCommentNode(this.page,e,c)}else a=null;return a},makeString:function(e,c){var a=null;
if(c-e>0)a=this.nodeFactory.createStringNode(this.page,e,c);return a},makeCData:function(e,c){var a=null;if(c-e>0)a=this.nodeFactory.createCDataNode(this.page,e,c);return a},makeTag:function(e,c,a){var b;b=c-e;if(0!=b){if(2>b)return this.makeString(e,c);e=this.nodeFactory.createTagNode(this.page,e,c,a)}else e=null;return e},createTagNode:function(e,c,a,b){return new k(e,c,a,b)},createStringNode:function(e,c,a){return new f(e,c,a)},createCDataNode:function(e,c,a){return new g(e,c,a)},createCommentNode:function(e,
c,a){return new q(e,c,a)},parseTag:function(e){var c,a=[],b=[],h,o=this.page,j=0,s=this.cursor;for(a[0]=s.position;!c;){a[j+1]=s.position;h=o.getChar(s);switch(j){case 0:if(h==-1||">"==h||"<"==h){if("<"==h){o.ungetChar(s);a[j+1]=s.position}c=true}else d.isWhitespace(h)||(j=1);break;case 1:if(-1==h||">"==h||"<"==h){if("<"==h){o.ungetChar(s);a[j+1]=s.getPosition}this.standalone(b,a);c=true}else if(d.isWhitespace(h)){a[6]=a[2];j=6}else if("="==h)j=2;break;case 2:if(-1==h||">"==h){this.standalone(b,a);
c=true}else if("'"==h){j=4;a[4]=a[3]}else if('"'==h){j=5;a[5]=a[3]}else d.isWhitespace(h)||(j=3);break;case 3:if(-1==h||">"==h){this.naked(b,a);c=true}else if(d.isWhitespace(h)){this.naked(b,a);a[0]=a[4];j=0}break;case 4:if(-1==h){this.single_quote(b,a);c=true}else if("'"==h){this.single_quote(b,a);a[0]=a[5]+1;j=0}break;case 5:if(-1==h){this.double_quote(b,a);c=true}else if('"'==h){this.double_quote(b,a);a[0]=a[6]+1;j=0}break;case 6:if(-1==h){this.standalone(b,a);a[0]=a[6];o.ungetChar(s);j=0}else if(!d.isWhitespace(h))if("="==
h){a[2]=a[6];a[3]=a[7];j=2}else{this.standalone(b,a);a[0]=a[6];o.ungetChar(s);j=0}break;default:throw Error("how ** did we get in state "+j);}}return this.makeTag(e,s.position,b)},parseComment:function(e,c){var a,b,h=this.page,o=this.cursor,j;a=false;for(j=0;!a;){b=h.getChar(o);if(-1==b)a=true;else switch(j){case 0:if(">"==b)a=true;if("-"==b)j=1;else return this.parseString(e,c);break;case 1:if("-"==b){b=h.getChar(o);if(-1==b)a=true;else if(">"==b)a=true;else{h.ungetChar(o);j=2}}else return this.parseString(e,
c);break;case 2:if("-"==b)j=3;else if(-1==b)return this.parseString(e,c);break;case 3:j="-"==b?4:2;break;case 4:if(">"==b)a=true;else d.isWhitespace(b)||(j=2);break;default:throw Error("how ** did we get in state "+j);}}return this.makeComment(e,o.position)},parseString:function(e,c){for(var a=0,b,h=this.page,o=this.cursor,j=0;!a;){b=h.getChar(o);if(-1==b)a=1;else if(c&&0==j&&("'"==b||'"'==b))j=b;else if(c&&0!=j&&"\\"==b){b=h.getChar(o);-1!=b&&"\\"!=b&&b!=j&&h.ungetChar(o)}else if(c&&b==j)j=0;else if(c&&
0==j&&b=="/"){b=h.getChar(o);if(-1==b)a=1;else if("/"==b){do b=h.getChar(o);while(-1!=b&&"\n"!=b)}else if("*"==b){do{do b=h.getChar(o);while(-1!=b&&"*"!=b);b=h.getChar(o);b=="*"&&h.ungetChar(o)}while(-1!=b&&"/"!=b)}else h.ungetChar(o)}else if(0==j&&"<"==b){b=h.getChar(o);if(-1==b)a=1;else{if("/"==b||d.isLetter(b)||"!"==b){a=1;h.ungetChar(o)}h.ungetChar(o)}}}return this.makeString(e,o.position)},parseCDATA:function(e,c){var a,b,h,o,j,s,r=this.cursor,t=this.page;a=r.position;b=0;h=false;o="";for(s=
false;!h;){j=t.getChar(r);switch(b){case 0:switch(j){case -1:h=true;break;case "'":if(e&&!s)if(""==o)o="'";else if("'"==o)o="";break;case '"':if(e&&!s)if(""==o)o='"';else if('"'==o)o="";break;case "\\":if(e)if(""!=o){j=t.getChar(r);if(-1==j)h=true;else j!="\\"&&j!=o&&t.ungetChar(r)}break;case "/":if(e)if(""==o){j=t.getChar(r);if(-1==j)h=true;else if("/"==j)s=true;else if("*"==j){do{do j=t.getChar(r);while(-1!=j&&"*"!=j);j=t.getChar(r);j=="*"&&t.ungetChar(r)}while(-1!=j&&"/"!=j)}else t.ungetChar(r)}break;
case "\n":s=false;break;case "<":if(e){if(""==o)b=1}else b=1}break;case 1:switch(j){case -1:h=true;break;case "/":b=!c||t.getText(r.position,r.position+c.length)===c&&!t.getText(r.position+c.length,r.position+c.length+1).match(/\w/)?2:0;break;case "!":j=t.getChar(r);if(-1==j)h=true;else if("-"==j){j=t.getChar(r);if(-1==j)h=true;else b="-"==j?3:0}else b=0;break;default:b=0}break;case 2:s=false;if(-1==j)h=true;else if(d.isLetter(j)){h=true;t.ungetChar(r);t.ungetChar(r);t.ungetChar(r)}else b=0;break;
case 3:s=false;if(-1==j)h=true;else if("-"==j){j=t.getChar(r);if(-1==j)h=true;else if("-"==j){j=t.getChar(r);if(-1==j)h=true;else if(">"==j)b=0;else{t.ungetChar(r);t.ungetChar(r)}}else t.ungetChar(r)}break;default:throw Error("unexpected "+b);}}return this.makeCData(a,r.position)},single_quote:function(e,c){var a=this.page;e.push(new l(a.getText(c[1],c[2]),"=",a.getText(c[4]+1,c[5]),"'"))},double_quote:function(e,c){var a=this.page;e.push(new l(a.getText(c[1],c[2]),"=",a.getText(c[5]+1,c[6]),'"'))},
standalone:function(e,c){e.push(new l(this.page.getText(c[1],c[2])))},naked:function(e,c){var a=this.page;e.push(new l(a.getText(c[1],c[2]),"=",a.getText(c[3],c[4])))}};return p},{requires:["./Cursor","./Page","../nodes/Text","../nodes/CData","../Utils","../nodes/Attribute","../nodes/Tag","../nodes/Comment"]});
KISSY.add("htmlparser/lexer/Page",function(i,m){function n(f){this.source=f;this.lineIndex=new m}n.prototype={getChar:function(f){var g=this.source,d=f.position;if(d>=g.length)return-1;var l=g.charAt(d);f.advance();if("\r"===l){l="\n";d=f.position;g.charAt(d)==="\n"&&f.advance()}"\n"===l&&this.lineIndex.add(f);return l},ungetChar:function(f){var g=this.source;f.retreat();var d=f.position,l=g.charAt(d);if(l==="\n"&&0!=d){l=g.charAt(d-1);"\r"===l&&f.retreat()}},getText:function(f,g){return this.source.slice(f,
g)},row:function(f){return this.lineIndex.row(f)},col:function(f){return this.lineIndex.col(f)}};return n},{requires:["./Index"]});KISSY.add("htmlparser/nodes/Attribute",function(){return function(i,m,n,f){this.nodeType=2;this.name=i;this.assignMent=m;this.value=n;this.quote=f}});
KISSY.add("htmlparser/nodes/CData",function(i,m){function n(){n.superclass.constructor.apply(this,arguments);this.nodeType=4;this.nodeName="#cdata"}i.extend(n,m,{writeHtml:function(f,g){var d=this.toHtml();if(!g||g.onCData(this)!==false)f.cdata(d)}});return n},{requires:["./Text"]});
KISSY.add("htmlparser/nodes/Comment",function(i,m){function n(){n.superclass.constructor.apply(this,arguments);this.nodeType=8;this.nodeName="#comment"}i.extend(n,m,{writeHtml:function(f,g){var d=this.toHtml();if(!g||g.onComment(this)!==false)f.comment(d)}});return n},{requires:["./Tag"]});
KISSY.add("htmlparser/nodes/Node",function(i){function m(n,f,g){this.parentNode=null;this.page=n;this.startPosition=f;this.endPosition=g;this.nextSibling=this.previousSibling=this.nodeName=null;if(i.Config.debug)this.toHtmlContent=this.toHtml()}m.prototype={toHtml:function(){if(this.page)return this.page.getText(this.startPosition,this.endPosition)},toString:function(){var n=[];n.push(this.nodeName+"  ["+this.startPosition+":"+this.endPosition+"]\n");n.push(this.toHtml());return n.join("")}};return m});
KISSY.add("htmlparser/nodes/Tag",function(i,m,n,f,g,d,l){function k(c,a,b,h){k.superclass.constructor.apply(this,arguments);this.childNodes=[];this.lastChild=this.firstChild=null;this.attributes=h||[];this.nodeType=1;h=this.attributes;if(h[0]){this.nodeName=h[0].name.toLowerCase();this.tagName=this.nodeName.replace(/\//,"");this.isEmptyXmlTag=!!l.$empty[this.nodeName];if(!this.isEmptyXmlTag)this.isEmptyXmlTag=/\/$/.test(this.nodeName);h.splice(0,1)}var o=h[h.length-1];if(o=!!(o&&/\/$/.test(o.name)))h.length-=
1;this.closed=this.isEmptyXmlTag=this.isEmptyXmlTag||o;this.closedEndPosition=this.closedStartPosition=-1;this.scanner=e[this.nodeName]||n}function q(c){var a=c.childNodes;c.firstChild=a[0];c.lastChild=a[a.length-1];if(a.length>=1){a[0].nextSibling=a[0].nextSibling=null;a[0].parentNode=c}if(a.length>1){for(var b=0;b<a.length-1;b++){a[b].nextSibling=a[b+1];a[b+1].previousSibling=a[b];a[b+1].parentNode=c}a[a.length-1].nextSibling=null}}function p(c,a){for(var b=0;b<c.length;b++)if(c[b].name==a)return c[b];
return null}var e={style:f,script:f,textarea:g};i.extend(k,m,{isEndTag:function(){return/^\//.test(this.nodeName)},appendChild:function(c){this.childNodes.push(c);q(this)},insertBefore:function(c){var a=c.parentNode.childNodes,b=i.indexOf(c,a);a.splice(b,0,this);q(c.parentNode)},removeChild:function(c){var a=c.parentNode.childNodes,b=i.indexOf(c,a);a.splice(b,1);q(c.parentNode)},getAttribute:function(c){return(c=p(this.attributes,c))&&c.value},setAttribute:function(c,a){var b=p(this.attributes,c);
if(b)b.value=a;else this.attributes.push(new d(c,"=",a,'"'))},removeAttribute:function(c){(c=p(this.attributes,c))&&this.attributes.splice(i.indexOf(c,this.attributes),1)},writeHtml:function(c,a){var b=this,h;h=b.tagName;if(a){if(!(h=a.onTagName(h)))return;b.tagName=h;h=a.onTag(b);if(h===false)return;if(h)b=h;if(b.nodeType!==1){b.writeHtml(c,a);return}if(!b.tagName){i.each(b.childNodes,function(r){r.writeHtml(c,a)});return}}c.openTag(b);for(var o=b.attributes,j=0;j<o.length;j++){var s=o[j];h=s.name;
if(a){if(!(h=a.onAttributeName(h)))continue;if(a.onAttribute(s)===false)continue}c.attribute(s,b)}c.openTagClose(b);if(!b.isEmptyXmlTag){i.each(b.childNodes,function(r){r.writeHtml(c,a)});c.closeTag(b)}}});return k},{requires:["./Node","../scanners/TagScanner","../scanners/QuoteCdataScanner","../scanners/TextareaScanner","./Attribute","../dtd"]});
KISSY.add("htmlparser/nodes/Text",function(i,m){function n(){n.superclass.constructor.apply(this,arguments);this.nodeType=3;this.nodeName="#text"}i.extend(n,m,{writeHtml:function(f,g){var d=this.toHtml();if(!g||g.onText(this)!==false)f.text(d)}});return n},{requires:["./Node"]});
KISSY.add("htmlparser/scanners/CdataScanner",function(){return{scan:function(i,m,n,f){n=m.parseCDATA(f,i.nodeName);f=m.getPosition();var g=m.nextNode();if(g)if(g.nodeType!=1||!(g.isEndTag()&&g.tagName==i.tagName))m.setPosition(f);i.closed=true;n&&i.appendChild(n);return i}}});KISSY.add("htmlparser/scanners/QuoteCdataScanner",function(i,m){return{scan:function(n,f,g){return m.scan(n,f,g,true)}}},{requires:["./CdataScanner"]});
KISSY.add("htmlparser/scanners/TagScanner",function(i,m){var n={scan:function(f,g,d,l){var k,q;if(f.isEmptyXmlTag)f.closed=true;else{do{if(k=g.nextNode())if(k.nodeType===1)if(k.isEndTag()&&k.tagName==f.tagName){f.closed=true;k=null}else if(l.fixByDtd&&!k.isEndTag()&&!this.canHasNodeAsChild(f,k)){g.setPosition(k.startPosition);k=null}else if(k.isEndTag()){if(k.isEndTag()){var p=-1;for(q=d.length-1;q>=0;q--){var e=d[q];if(e.tagName===k.tagName){p=q;break}else if(l.fixByDtd&&!this.canHasNodeAsChild(e,
k)){p=q;break}}if(p!=-1){f.closed=true;d[d.length-1].appendChild(f);for(q=d.length-1;q>p;q--){f=d[q];k=d[q-1];f.closed=true;k.appendChild(f)}f=d[p];d.length=p;k=null}}}else if(q=k.scanner)if(q===n)if(k.isEmptyXmlTag)f.appendChild(k);else{d.push(f);f=k}else{k=q.scan(k,g,d,l);f.appendChild(k)}else f.appendChild(k);else f.appendChild(k);if(k==null)if(d.length>0){k=d[d.length-1];if(k.nodeType==1)if(k.scanner===n){d.length-=1;f.closed=true;k.appendChild(f);f=k}else k=null;else k=null}}while(k);f.closed=
true}return f},canHasNodeAsChild:function(f,g){var d=g.nodeName;if(g.nodeType==3)d="#";return!!m[f.tagName][d]}};return n},{requires:["../dtd"]});KISSY.add("htmlparser/scanners/TextareaScanner",function(i,m){return{scan:function(n,f,g){return m.scan(n,f,g,false)}}},{requires:["./CdataScanner"]});
KISSY.add("htmlparser/writer/basic",function(){function i(){this.output=[]}i.prototype={append:function(){for(var m=this.output,n=arguments,f,g=0;g<n.length;g++){f=n[g];if(f.length>1)for(var d=0;d<f.length;d++)m.push(f.charAt(d));else m.push(f)}return this},openTag:function(m){this.append("<",m.tagName)},openTagClose:function(m){m.isEmptyXmlTag&&this.append(" ","/");this.append(">")},closeTag:function(m){this.append("</",m.tagName,">")},attribute:function(m){this.append(" ",m.name,'="',(m.value||
m.name).replace(/"/g,"&quote;"),'"')},text:function(m){this.append(m)},cdata:function(m){this.append(m)},comment:function(m){this.append(m)},getHtml:function(){return this.output.join("")}};return i});
KISSY.add("htmlparser/writer/beautify",function(i,m,n,f){function g(){g.superclass.constructor.apply(this,arguments);this.inPre=0;this.indentChar="\t";this.allowIndent=this.indentLevel=0;this.rules={};for(var d in i.merge(n.$nonBodyContent,n.$block,n.$listItem,n.$tableContent,{select:1,script:1,style:1}))this.setRules(d,{allowIndent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("option",{breakBeforeOpen:1});this.setRules("optiongroup",{breakBeforeOpen:1});
this.setRules("br",{breakAfterOpen:1});this.setRules("title",{allowIndent:0,breakBeforeClose:0,breakAfterOpen:0});this.setRules("pre",{allowIndent:0})}i.extend(g,m,{indentation:function(){this.inPre||this.append(Array(this.indentLevel+1).join(this.indentChar));this.allowIndent=0},lineBreak:function(){var d=this.output;if(!this.inPre&&d.length){for(var l=d.length-1;l>=0;l--)if(!/[\r\n\t ]/.test(d[l]))break;d.length=l+1;this.append("\n")}this.allowIndent=1},setRules:function(d,l){this.rules[d]||(this.rules[d]=
{});i.mix(this.rules[d],l)},openTag:function(d){var l=this.rules[d.tagName]||{};if(this.allowIndent)this.indentation();else if(l.breakBeforeOpen){this.lineBreak();this.indentation()}g.superclass.openTag.apply(this,arguments)},openTagClose:function(d){var l=d.tagName,k=this.rules[l]||{};if(d.isEmptyXmlTag)this.append(" />");else{this.append(">");k.allowIndent&&this.indentLevel++}k.breakAfterOpen&&this.lineBreak();if(l==="pre")this.inPre=1},closeTag:function(d){var l=d.tagName,k=this.rules[l]||{};k.allowIndent&&
this.indentLevel--;if(this.allowIndent)this.indentation();else if(k.breakBeforeClose){this.lineBreak();this.indentation()}g.superclass.closeTag.apply(this,arguments);if(l==="pre")this.inPre=0;k.breakAfterClose&&this.lineBreak()},text:function(d){this.allowIndent&&this.indentation();this.inPre||(d=f.collapseWhitespace(d));this.append(d)},comment:function(d){this.allowIndent&&this.indentation();this.append(d)},cdata:function(d){this.allowIndent&&this.indentation();this.append(d)}});return g},{requires:["./basic",
"../dtd","../Utils"]});
KISSY.add("htmlparser/writer/filter",function(i){function m(){this.tagNames=[];this.attributeNames=[];this.tags=[];this.comments=[];this.texts=[];this.cdatas=[];this.attributes=[]}function n(g,d){for(var l=0;l<g.length;l++)i.each(g[l].value,function(k){d=d.replace(k[0],k[1])});return d}function f(g,d,l){for(var k=0;k<g.length;k++)if(g[k].value.apply(null,d)===false)return false;return l}m.prototype={addRules:function(g,d){d=d||10;for(var l in g){var k=this[l],q;a:{for(q=0;q<k.length;q++)if(k[q].priority>
d){q=q;break a}q=k.length}k.splice(q,0,{value:g[l],priority:d})}},onTagName:function(g){return n(this.tagNames,g)},onAttributeName:function(g){return n(this.attributeNames,g)},onText:function(g){return f(this.texts,[g.toHtml(),g],g)},onCData:function(g){return f(this.cdatas,[g.toHtml(),g],g)},onAttribute:function(g,d){return f(this.attributes,[d,g],d)},onComment:function(g){return f(this.comments,[g.toHtml(),g],g)},onNode:function(g){var d=g.nodeType;if(d===1)return this.onTag(g);else if(d===3)return this.onText(g.toHtml(),
g);else if(d===8)return this.onComment(g.toHtml(),g)},onTag:function(g){for(var d=["^",g.tagName,"$"],l=this.tags,k,q=0;q<d.length;q++)for(var p=d[q],e=0;e<l.length;e++){var c=l[e].value;if(c[p]){if((k=c[p](g))===false)return false;if(k&&k!=c)return this.onNode(k);if(!g.name)return g}}return g}};return m});
KISSY.add("htmlparser/writer/minify",function(i,m,n){function f(p){return p.replace(/"/g,"&quote;")}function g(p,e){var c=p.nodeName,a=e.name,b=e.value||"";if(/^on[a-z]+/.test(a))b=l(b).replace(/^javascript:[\s\xa0]*/i,"").replace(/[\s\xa0]*;$/,"");else if(a==="class")b=k(l(b));else if(/^(?:a|area|link|base)$/.test(c)&&a==="href"||c==="img"&&/^(?:src|longdesc|usemap)$/.test(a)||c==="object"&&/^(?:classid|codebase|data|usemap)$/.test(a)||c==="q"&&a==="cite"||c==="blockquote"&&a==="cite"||(c==="ins"||
c==="del")&&a==="cite"||c==="form"&&a==="action"||c==="input"&&(a==="src"||a==="usemap")||c==="head"&&a==="profile"||c==="script"&&(a==="src"||a==="for")||/^(?:a|area|object|button)$/.test(c)&&a==="tabindex"||c==="input"&&(a==="maxlength"||a==="tabindex")||c==="select"&&(a==="size"||a==="tabindex")||c==="textarea"&&/^(?:rows|cols|tabindex)$/.test(a)||c==="colgroup"&&a==="span"||c==="col"&&a==="span"||(c==="th"||c=="td")&&(a==="rowspan"||a==="colspan"))b=l(b);else if(a==="style")b=l(b).replace(/[\s\xa0]*;[\s\xa0]*$/,
"");return b}function d(){d.superclass.constructor.apply(this,arguments);this.inPre=0}var l=i.trim,k=n.collapseWhitespace,q=RegExp("^(?:class|id|style|title|lang|dir|on(?:focus|blur|change|click|dblclick|mouse(?:down|up|over|move|out)|key(?:press|down|up)))$");i.extend(d,m,{comment:function(p){if(/\[if[^\]]+\]/.test(p)){p=p.replace(/^(\[[^\]]+\]>)[\s\xa0]*/,"$1").replace(/[\s\xa0]*(<!\[endif\])$/,"$1");d.superclass.comment.call(this,p)}},openTag:function(p){if(p.tagName=="pre")this.inPre=1;d.superclass.openTag.apply(this,
arguments)},closeTag:function(p){if(p.tagName=="pre")this.inPre=0;d.superclass.closeTag.apply(this,arguments)},cdata:function(p){p=l(p).replace(/^(?:[\s\xa0]*\/\*[\s\xa0]*<!\[CDATA\[[\s\xa0]*\*\/|[\s\xa0]*\/\/[\s\xa0]*<!\[CDATA\[.*)/,"").replace(/(?:\/\*[\s\xa0]*\]\]>[\s\xa0]*\*\/|\/\/[\s\xa0]*\]\]>)[\s\xa0]*$/,"");d.superclass.cdata.call(this,p)},attribute:function(p,e){var c=p.name,a=p.value||"",b;b=p.name;b=l(p.value||"")?0:e==="input"&&b==="value"||q.test(b);if(!(b=b)){b=e.nodeName;var h=p.name,
o=p.value||"";o=l(o.toLowerCase());b=b==="script"&&h==="language"&&o==="javascript"||b==="form"&&h==="method"&&o==="get"||b==="input"&&h==="type"&&o==="text"||b==="script"&&h==="type"&&o==="text/javascript"||b==="style"&&h==="type"&&o==="text/css"||b==="area"&&h==="shape"&&o==="rect"}if(!b)if(/^(?:checked|disabled|selected|readonly)$/i.test(c))this.append(" ",c);else/^[a-zA-Z0-9-._:]+$/.test(a)?this.append(" ",c,"=",f(g(e,p))):this.append(" ",c,'="',f(g(e,p)),'"')},text:function(p){this.inPre||this.append(k(p))}});
return d},{requires:["./basic","../Utils"]});KISSY.add("htmlparser",function(i,m,n,f,g,d,l){return{Lexer:m,Parser:n,BasicWriter:f,BeautifyWriter:g,MinifyWriter:d,Filter:l}},{requires:["htmlparser/lexer/Lexer","htmlparser/Parser","htmlparser/writer/basic","htmlparser/writer/beautify","htmlparser/writer/minify","htmlparser/writer/filter"]});
