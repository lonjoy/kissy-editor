/*
Copyright 2012, KISSY UI Library v1.20
MIT Licensed
build time: Jan 6 12:01
*/
KISSY.add("calendar/base",function(k,l,j,m){function i(a,e){this._init(a,e)}var f=j.Target,b=l.all;k.augment(i,{_init:function(a,e){var c=b(a);this.id=this.C_Id=this._stamp(c);this._buildParam(e);if(this.popup){this.trigger=c;this.con=new l("<div>");b(document.body).append(this.con);this.C_Id=this._stamp(this.con);this.con.css({top:"0px",position:"absolute",background:"white",visibility:"hidden"})}else this.con=c;c=function(){};k.augment(c,f);c=new c;k.mix(this,c);this.render();this._buildEvent();
return this},render:function(a){var e=0,c,d;a=a||{};this._parseParam(a);this.ca=[];this.con.addClass("ks-cal-call ks-clearfix multi-"+this.pages);this.con.html("");e=0;for(d=[this.year,this.month];e<this.pages;e++){if(e===0)a=true;else{a=false;d=this._computeNextMonth(d)}c=e==this.pages-1;this.ca.push(new this.Page({year:d[0],month:d[1],prevArrow:a,nextArrow:c,showTime:this.showTime},this));this.ca[e].render()}return this},_stamp:function(a){a.attr("id")||a.attr("id",k.guid("K_Calendar"));return a.attr("id")},
_showdate:function(a,e){var c=new Date(e-0+a*864E5);c=c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate();return new Date(c)},_buildEvent:function(){var a=this,e,c;if(!a.popup)return this;k.each(a.EV,function(d){d&&d.target.detach(d.type,d.fn)});a.EV=a.EV||[];e=a.EV[0]={target:b(document),type:"click"};e.fn=function(d){var g=b(d.target);if(g.attr("id")!==a.C_Id)if(!((g.hasClass("ks-next")||g.hasClass("ks-prev"))&&g[0].tagName==="A"))if(g.attr("id")!=a.id)if(a.con.css("visibility")!="hidden")a.con.contains(g)&&
(g[0].nodeName.toLowerCase()==="option"||g[0].nodeName.toLowerCase()==="select")||function(n,h){return n[0]>h[0].x&&n[0]<h[1].x&&n[1]>h[0].y&&n[1]<h[1].y}([d.pageX,d.pageY],[{x:a.con.offset().left,y:a.con.offset().top},{x:a.con.offset().left+a.con.width(),y:a.con.offset().top+a.con.height()}])||a.hide()};e.target.on(e.type,e.fn);for(c=0;c<a.triggerType.length;c++){e=a.EV[c+1]={target:b("#"+a.id),type:a.triggerType[c],fn:function(d){d.target=b(d.target);d.preventDefault();var g=a.triggerType;if(k.inArray("click",
g)&&k.inArray("focus",g))d.type=="focus"&&a.toggle();else if(k.inArray("click",g)&&!k.inArray("focus",g))d.type=="click"&&a.toggle();else!k.inArray("click",g)&&k.inArray("focus",g)?setTimeout(function(){a.toggle()},170):a.toggle()}};e.target.on(e.type,e.fn)}return this},toggle:function(){this.con.css("visibility")=="hidden"?this.show():this.hide()},show:function(){this.con.css("visibility","");var a=this.trigger.offset().left,e=this.trigger.outerHeight()||this.trigger.height();e=this.trigger.offset().top+
e;this.con.css("left",a.toString()+"px");this.con.css("top",e.toString()+"px");this.fire("show");return this},hide:function(){this.con.css("visibility","hidden");this.fire("hide");return this},_buildParam:function(a){function e(n,h){var o=a[h];c[h]=o===m||o===null?n:o}var c=this;if(a===m||a===null)a={};k.each({date:new Date,startDay:0,pages:1,closable:false,rangeSelect:false,minDate:false,maxDate:false,multiSelect:false,navigator:true,popup:false,showTime:false,triggerType:["click"]},e);if(typeof a.triggerType===
"string")a.triggerType=[a.triggerType];e(c.date,"selected");if(a.startDay)c.startDay=(7-a.startDay)%7;if(a.range!==m&&a.range!==null){var d=c._showdate(1,new Date(a.range.start.getFullYear()+"/"+(a.range.start.getMonth()+1)+"/"+a.range.start.getDate())),g=c._showdate(1,new Date(a.range.end.getFullYear()+"/"+(a.range.end.getMonth()+1)+"/"+a.range.end.getDate()));c.range={start:d,end:g}}else c.range={start:null,end:null};c.EV=[];return this},_parseParam:function(a){var e;if(a===m||a===null)a={};for(e in a)this[e]=
a[e];this._handleDate();return this},_templetShow:function(a,e){var c,d,g,n;if(e instanceof Array){c="";for(d=0;d<e.length;d++)c+=arguments.callee(a,e[d]);a=c}else{c=a.match(/{\$(.*?)}/g);if(e!==m&&c!==null){d=0;for(g=c.length;d<g;d++){n=c[d].replace(/({\$)|}/g,"");n=e[n]!==m?e[n]:"";a=a.replace(c[d],n)}}}return a},_handleDate:function(){var a=this.date;this.weekday=a.getDay()+1;this.day=a.getDate();this.month=a.getMonth();this.year=a.getFullYear();return this},_getHeadStr:function(a,e){return a.toString()+
"\u5e74"+(Number(e)+1).toString()+"\u6708"},_monthAdd:function(){if(this.month==11){this.year++;this.month=0}else this.month++;this.date=new Date(this.year.toString()+"/"+(this.month+1).toString()+"/1");return this},_monthMinus:function(){if(this.month===0){this.year--;this.month=11}else this.month--;this.date=new Date(this.year.toString()+"/"+(this.month+1).toString()+"/1");return this},_computeNextMonth:function(a){var e=a[0];a=a[1];if(a==11){e++;a=0}else a++;return[e,a]},_handleOffset:function(){var a=["\u65e5",
"\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],e=this.startDay,c="";c=[];for(var d=0;d<7;d++)c[d]={day:a[(d-e+7)%7]};c=this._templetShow("<span>{$day}</span>",c);return{day_html:c}},_handleRange:function(a){if(this.range.start===null&&this.range.end===null||this.range.start!==null&&this.range.end!==null){this.range.start=a;this.range.end=null;this.render()}else if(this.range.start!==null&&this.range.end===null){this.range.end=a;if(this.range.start.getTime()>this.range.end.getTime()){a=this.range.start;this.range.start=
this.range.end;this.range.end=a}this.fire("rangeSelect",this.range);this.render()}return this}});return i},{requires:["node","event"]});
KISSY.add("calendar/date",function(){var k=function(){var l=/w{1}|d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,j=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,m=/[^-+\dA-Z]/g,i=function(a,e){a=String(a);for(e=e||2;a.length<e;)a="0"+a;return a},f={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT Z",
isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUTCDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",localShortDate:"yy\u5e74mm\u6708dd\u65e5",localShortDateTime:"yy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localLongDate:"yyyy\u5e74mm\u6708dd\u65e5",localLongDateTime:"yyyy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localFullDate:"yyyy\u5e74mm\u6708dd\u65e5 w",localFullDateTime:"yyyy\u5e74mm\u6708dd\u65e5 w hh:MM:ss TT"},b={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94",
"\u661f\u671f\u516d"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return function(a,e,c){if(arguments.length==1&&Object.prototype.toString.call(a)=="[object String]"&&!/\d/.test(a)){e=a;a=undefined}a=a?new Date(a):new Date;if(isNaN(a))throw SyntaxError("invalid date");e=String(f[e]||e||f["default"]);if(e.slice(0,4)=="UTC:"){e=e.slice(4);c=true}var d=c?"getUTC":"get",
g=a[d+"Date"](),n=a[d+"Day"](),h=a[d+"Month"](),o=a[d+"FullYear"](),p=a[d+"Hours"](),s=a[d+"Minutes"](),t=a[d+"Seconds"]();d=a[d+"Milliseconds"]();var r=c?0:a.getTimezoneOffset(),u={d:g,dd:i(g,undefined),ddd:b.dayNames[n],dddd:b.dayNames[n+7],w:b.dayNames[n+14],m:h+1,mm:i(h+1,undefined),mmm:b.monthNames[h],mmmm:b.monthNames[h+12],yy:String(o).slice(2),yyyy:o,h:p%12||12,hh:i(p%12||12,undefined),H:p,HH:i(p,undefined),M:s,MM:i(s,undefined),s:t,ss:i(t,undefined),l:i(d,3),L:i(d>99?Math.round(d/10):d,undefined),
t:p<12?"a":"p",tt:p<12?"am":"pm",T:p<12?"A":"P",TT:p<12?"AM":"PM",Z:c?"UTC":(String(a).match(j)||[""]).pop().replace(m,""),o:(r>0?"-":"+")+i(Math.floor(Math.abs(r)/60)*100+Math.abs(r)%60,4),S:["th","st","nd","rd"][g%10>3?0:(g%100-g%10!=10)*g%10]};return e.replace(l,function(q){return q in u?u[q]:q.slice(1,q.length-1)})}}();return{format:function(l,j,m){return k(l,j,m)},parse:function(l){var j=null;if(j instanceof Date)l=j;else{j=new Date(l);l=j instanceof Date&&j!="Invalid Date"&&!isNaN(j)?j:null}return l}}});
KISSY.add("calendar/page",function(k,l,j,m){k.augment(m,{Page:function(i,f){this.father=f;this.month=Number(i.month);this.year=Number(i.year);this.prevArrow=i.prevArrow;this.nextArrow=i.nextArrow;this.timmer=this.node=null;this.id="";this.EV=[];this.html=['<div class="ks-cal-box" id="{$id}"><div class="ks-cal-hd"><a href="javascript:void(0);" class="ks-prev {$prev}"><</a><a href="javascript:void(0);" class="ks-title">{$title}</a><a href="javascript:void(0);" class="ks-next {$next}">></a></div><div class="ks-cal-bd"><div class="ks-whd">',
f._handleOffset().day_html,'</div><div class="ks-dbd ks-clearfix">{$ds}</div></div><div class="ks-setime hidden"></div><div class="ks-cal-ft {$showtime}"><div class="ks-cal-time">\u65f6\u95f4\uff1a00:00 &hearts;</div></div><div class="ks-selectime hidden"></div></div><!--#ks-cal-box--\>'].join("");this.nav_html='<p>\u6708<select value="{$the_month}"><option class="m1" value="1">01</option><option class="m2" value="2">02</option><option class="m3" value="3">03</option><option class="m4" value="4">04</option><option class="m5" value="5">05</option><option class="m6" value="6">06</option><option class="m7" value="7">07</option><option class="m8" value="8">08</option><option class="m9" value="9">09</option><option class="m10" value="10">10</option><option class="m11" value="11">11</option><option class="m12" value="12">12</option></select></p><p>\u5e74<input type="text" value="{$the_year}" onfocus="this.select()"/></p><p><button class="ok">\u786e\u5b9a</button><button class="cancel">\u53d6\u6d88</button></p>';
this.Verify=function(){return{isDay:function(b){if(!/^\d+$/i.test(b))return false;b=Number(b);return!(b<1||b>31)},isYear:function(b){if(!/^\d+$/i.test(b))return false;b=Number(b);return!(b<100||b>1E4)},isMonth:function(b){if(!/^\d+$/i.test(b))return false;b=Number(b);return!(b<1||b>12)}}};this._renderUI=function(){var b={};this.HTML="";b.prev="";b.next="";b.title="";b.ds="";if(!this.prevArrow)b.prev="hidden";if(!this.nextArrow)b.next="hidden";if(!this.father.showtime)b.showtime="hidden";b.id=this.id=
"ks-cal-"+Math.random().toString().replace(/.\./i,"");b.title=this.father._getHeadStr(this.year,this.month);this.createDS();b.ds=this.ds;this.father.con.append(this.father._templetShow(this.html,b));this.node=j.one("#"+this.id);if(this.father.showTime){b=this.node.one(".ks-cal-ft");b.removeClass("hidden");this.timmer=new this.father.TimeSelector(b,this.father)}return this};this._buildEvent=function(){function b(){e.target.on(e.type,e.fn)}var a=this,e,c=j.one("#"+a.id);k.each(a.EV,function(d){d&&d.target.detach(d.type,
d.fn)});a.EV=a.EV||[];e=a.EV[0]={target:c.one("div.ks-dbd"),type:"click",fn:function(d){d.target=j(d.target);if(!d.target.hasClass("ks-null"))if(!d.target.hasClass("ks-disabled")){d=Number(d.target.html());var g=new Date("2010/01/01");g.setYear(a.year);g.setMonth(a.month);g.setDate(d);a.father.dt_date=g;a.father.fire("select",{date:g});a.father.popup&&a.father.closable&&a.father.hide();a.father.rangeSelect&&a.father._handleRange(g);a.father.render({selected:g})}}};b();e=a.EV[1]={target:c.one("a.ks-prev"),
type:"click",fn:function(d){d.preventDefault();a.father._monthMinus().render();a.father.fire("monthChange",{date:new Date(a.father.year+"/"+(a.father.month+1)+"/01")})}};b();e=a.EV[2]={target:c.one("a.ks-next"),type:"click",fn:function(d){d.preventDefault();a.father._monthAdd().render();a.father.fire("monthChange",{date:new Date(a.father.year+"/"+(a.father.month+1)+"/01")})}};b();if(a.father.navigator){e=a.EV[3]={target:c.one("a.ks-title"),type:"click",fn:function(d){try{a.timmer.hidePopup();d.preventDefault()}catch(g){}d.target=
j(d.target);d=c.one(".ks-setime");d.html("");var n=a.father._templetShow(a.nav_html,{the_month:a.month+1,the_year:a.year});d.html(n);d.removeClass("hidden");c.one("input").on("keydown",function(h){h.target=j(h.target);if(h.keyCode==38){h.target.val(Number(h.target.val())+1);h.target[0].select()}if(h.keyCode==40){h.target.val(Number(h.target.val())-1);h.target[0].select()}if(h.keyCode==13){h=c.one(".ks-setime").one("select").val();var o=c.one(".ks-setime").one("input").val();c.one(".ks-setime").addClass("hidden");
if(a.Verify().isYear(o))if(a.Verify().isMonth(h)){a.father.render({date:new Date(o+"/"+h+"/01")});a.father.fire("monthChange",{date:new Date(o+"/"+h+"/01")})}}})}};b();e=a.EV[4]={target:c.one(".ks-setime"),type:"click",fn:function(d){d.preventDefault();d.target=j(d.target);if(d.target.hasClass("ok")){d=c.one(".ks-setime").one("select").val();var g=c.one(".ks-setime").one("input").val();c.one(".ks-setime").addClass("hidden");if(a.Verify().isYear(g))if(a.Verify().isMonth(d)){a.father.render({date:new Date(g+
"/"+d+"/01")});a.father.fire("monthChange",{date:new Date(g+"/"+d+"/01")})}}else d.target.hasClass("cancel")&&c.one(".ks-setime").addClass("hidden")}};b()}return this};this._getNode=function(){return this.node};this._getNumOfDays=function(b,a){return 32-(new Date(b,a-1,32)).getDate()};this.createDS=function(){var b="",a=((new Date(this.year+"/"+(this.month+1)+"/01")).getDay()+this.father.startDay+7)%7,e=this._getNumOfDays(this.year,this.month+1)+a,c,d;for(c=0;c<e;c++){d=/532/.test(l.webkit)?new Date(this.year+
"/"+Number(this.month+1)+"/"+(c+1-a).toString()):new Date(this.year+"/"+Number(this.month+1)+"/"+(c+2-a).toString());var g=new Date(this.year+"/"+Number(this.month+1)+"/"+(c+1-a).toString());b+=c<a?'<a href="javascript:void(0);" class="ks-null">0</a>':this.father.minDate instanceof Date&&(new Date(this.year+"/"+(this.month+1)+"/"+(c+2-a))).getTime()<this.father.minDate.getTime()+1?'<a href="javascript:void(0);" class="ks-disabled">'+(c-a+1)+"</a>":this.father.maxDate instanceof Date&&(new Date(this.year+
"/"+(this.month+1)+"/"+(c+1-a))).getTime()>this.father.maxDate.getTime()?'<a href="javascript:void(0);" class="ks-disabled">'+(c-a+1)+"</a>":this.father.range.start!==null&&this.father.range.end!==null&&d.getTime()>=this.father._showdate(1,this.father.range.start).getTime()&&g.getTime()<this.father._showdate(1,this.father.range.end).getTime()?c==a+(new Date).getDate()-1&&(new Date).getFullYear()==this.year&&(new Date).getMonth()==this.month?'<a href="javascript:void(0);" class="ks-range ks-today">'+
(c-a+1)+"</a>":'<a href="javascript:void(0);" class="ks-range">'+(c-a+1)+"</a>":c==a+(new Date).getDate()-1&&(new Date).getFullYear()==this.year&&(new Date).getMonth()==this.month?'<a href="javascript:void(0);" class="ks-today">'+(c-a+1)+"</a>":c==a+this.father.selected.getDate()-1&&this.month==this.father.selected.getMonth()&&this.year==this.father.selected.getFullYear()?'<a href="javascript:void(0);" class="ks-selected">'+(c-a+1)+"</a>":'<a href="javascript:void(0);">'+(c-a+1)+"</a>"}if(e%7!==0)for(c=
0;c<7-e%7;c++)b+='<a href="javascript:void(0);" class="ks-null">0</a>';this.ds=b;return this};this.render=function(){this._renderUI();this._buildEvent();return this}}});return m},{requires:["ua","node","calendar/base"]});
KISSY.add("calendar/time",function(k,l,j){k.augment(j,{TimeSelector:function(m,i){this.father=i;this.fcon=m.parent(".ks-cal-box");this.popupannel=this.fcon.one(".ks-selectime");if(typeof i._time=="undefined")i._time=new Date;this.time=i._time;this.status="s";this.ctime=l('<div class="ks-cal-time">\u65f6\u95f4\uff1a<span class="h">h</span>:<span class="m">m</span>:<span class="s">s</span><!--{{arrow--\><div class="cta"><button class="u"></button><button class="d"></button></div><!--arrow}}--\></div>');this.button=
l('<button class="ct-ok">\u786e\u5b9a</button>');this.h_a=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"];this.m_a=["00","10","20","30","40","50"];this.s_a=["00","10","20","30","40","50"];this.parseSubHtml=function(f){for(var b="",a=0;a<f.length;a++)b+='<a href="javascript:void(0);" class="item">'+f[a]+"</a>";b+='<a href="javascript:void(0);" class="x">x</a>';return b};this.showPopup=function(f){this.popupannel.html(f);this.popupannel.removeClass("hidden");
f=this.status;this.ctime.all("span").removeClass("on");switch(f){case "h":this.ctime.all(".h").addClass("on");break;case "m":this.ctime.all(".m").addClass("on");break;case "s":this.ctime.all(".s").addClass("on")}};this.hidePopup=function(){this.popupannel.addClass("hidden")};this.render=function(){var f=this.get("h"),b=this.get("m"),a=this.get("s");this.father._time=this.time;this.ctime.all(".h").html(f);this.ctime.all(".m").html(b);this.ctime.all(".s").html(a);return this};this.set=function(f,b){b=
Number(b);switch(f){case "h":this.time.setHours(b);break;case "m":this.time.setMinutes(b);break;case "s":this.time.setSeconds(b)}this.render()};this.get=function(f){var b=this.time;switch(f){case "h":return b.getHours();case "m":return b.getMinutes();case "s":return b.getSeconds()}};this.add=function(){var f=this.status,b=this.get(f);b++;this.set(f,b)};this.minus=function(){var f=this.status,b=this.get(f);b--;this.set(f,b)};this._init=function(){var f=this;m.html("").append(f.ctime);m.append(f.button);
f.render();f.popupannel.on("click",function(b){b=l(b.target);if(b.hasClass("x"))f.hidePopup();else if(b.hasClass("item")){b=Number(b.html());f.set(f.status,b);f.hidePopup()}});f.button.on("click",function(){var b=typeof f.father.dt_date=="undefined"?f.father.date:f.father.dt_date;b.setHours(f.get("h"));b.setMinutes(f.get("m"));b.setSeconds(f.get("s"));f.father.fire("timeSelect",{date:b});f.father.popup&&f.father.closable&&f.father.hide()});f.ctime.on("keyup",function(b){if(b.keyCode==38||b.keyCode==
37){b.preventDefault();f.add()}if(b.keyCode==40||b.keyCode==39){b.preventDefault();f.minus()}});f.ctime.one(".u").on("click",function(){f.hidePopup();f.add()});f.ctime.one(".d").on("click",function(){f.hidePopup();f.minus()});f.ctime.one(".h").on("click",function(){var b=f.parseSubHtml(f.h_a);f.status="h";f.showPopup(b)});f.ctime.one(".m").on("click",function(){var b=f.parseSubHtml(f.m_a);f.status="m";f.showPopup(b)});f.ctime.one(".s").on("click",function(){var b=f.parseSubHtml(f.s_a);f.status="s";
f.showPopup(b)})};this._init()}});return j},{requires:["node","calendar/base"]});KISSY.add("calendar",function(k,l,j,m,i){k.Calendar=l;k.Date=i;l.Date=i;return l},{requires:["calendar/base","calendar/page","calendar/time","calendar/date"]});
