/*
Copyright 2011, KISSY UI Library v1.20dev
MIT Licensed
build time: Nov 4 17:09
*/
KISSY.add("dd/ddm",function(j,m,n,i,k){function e(){e.superclass.constructor.apply(this,arguments);this._init()}function g(b){var d=b.offset();return{left:d.left,right:d.left+b.outerWidth(),top:d.top,bottom:d.top+b.outerHeight()}}function a(b,d){return b.left<=d.left&&b.right>=d.left&&b.top<=d.top&&b.bottom>=d.top}function h(b){if(b.top>=b.bottom||b.left>=b.right)return 0;return(b.right-b.left)*(b.bottom-b.top)}function c(b,d){return{left:Math.max(b.left,d.left),right:Math.min(b.right,d.right),top:Math.max(b.top,
d.top),bottom:Math.min(b.bottom,d.bottom)}}var f=document;e.ATTRS={prefixCls:{value:"ks-dd-"},bufferTime:{value:200},activeDrag:{},activeDrop:{},drops:{value:[]}};j.extend(e,k,{_regDrop:function(b){this.get("drops").push(b)},_unregDrop:function(b){b=j.indexOf(b,this.get("drops"));b!=-1&&this.get("drops").splice(b,1)},_init:function(){this._showShimMove=j.throttle(this._move,30,this)},_move:function(b){var d=this.get("activeDrag");if(d){b.preventDefault();d._move(b);this._notifyDropsMove(b)}},_notifyDropsMove:function(b){var d=
this.get("activeDrag"),l=d.get("mode"),s=this.get("drops"),q,v=0,u=g(d.get("node")),w=h(u);j.each(s,function(p){var o=p.getNodeFromTarget(b,d.get("dragNode")[0],d.get("node")[0]);if(o)if(l=="point"){if(a(g(o),d.mousePos))if(!q||q.get("node").contains(o))q=p}else if(l=="intersect"){o=h(c(u,g(o)));if(o>v){v=o;q=p}}else if(l=="strict"){o=h(c(u,g(o)));if(o==w){q=p;return false}}});(s=this.get("activeDrop"))&&s!=q&&s._handleOut(b);if(q)q._handleOver(b);else{d.get("node").removeClass(this.get("prefixCls")+
"drag-over");this.set("activeDrop",null)}},_deactivateDrops:function(){var b=this.get("activeDrag"),d=this.get("activeDrop");b.get("node").removeClass(this.get("prefixCls")+"drag-over");if(d){var l={drag:b,drop:d};d.get("node").removeClass(this.get("prefixCls")+"drop-over");d.fire("drophit",l);b.fire("dragdrophit",l);this.fire("drophit",l);this.fire("dragdrophit",l)}else{b.fire("dragdropmiss",{drag:b});this.fire("dragdropmiss",{drag:b})}},_start:function(b){var d=this,l=d.get("bufferTime")||0;d._registerEvent();
if(l)d._bufferTimer=setTimeout(function(){d._bufferStart(b)},l);else d._bufferStart(b)},_bufferStart:function(b){this.set("activeDrag",b);b.get("shim")&&this._activeShim();b._start();b.get("dragNode").addClass(this.get("prefixCls")+"dragging")},_end:function(b){var d=this.get("activeDrag");this._unregisterEvent();if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=null}this._shim&&this._shim.css({display:"none"});if(d){d._end(b);d.get("dragNode").removeClass(this.get("prefixCls")+
"dragging");this._deactivateDrops(b);this.set("activeDrag",null);this.set("activeDrop",null)}},_activeShim:function(){var b=document;this._shim=(new i("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;cursor:move;z-index:999999;'></div>")).prependTo(b.body||b.documentElement);this._shim.css("opacity",0);this._activeShim=this._showShim;this._showShim()},_showShim:function(){this._shim.css({display:"",height:m.docHeight()})},_registerEvent:function(){n.on(f,"mouseup",this._end,
this);n.on(f,"mousemove",this._showShimMove,this)},_unregisterEvent:function(){n.remove(f,"mousemove",this._showShimMove,this);n.remove(f,"mouseup",this._end,this)}});k=new e;k.inRegion=a;k.region=g;return k},{requires:["dom","event","node","base"]});
KISSY.add("dd/draggable",function(j,m,n,i,k){function e(){e.superclass.constructor.apply(this,arguments);this._init()}var g=j.each;e.POINT="point";e.INTERSECT="intersect";e.STRICT="strict";e.ATTRS={node:{setter:function(a){return n.one(a)}},dragNode:{},shim:{value:true},handlers:{value:[],getter:function(a){var h=this,c=h.get("cursor");a.length||(a[0]=h.get("node"));g(a,function(f,b){if(j.isFunction(f))f=f.call(h);if(j.isString(f)||f.nodeType)f=n.one(f);f.unselectable();c&&f.css("cursor",c);a[b]=
f});h.__set("handlers",a);return a}},cursor:{value:"move"},mode:{value:"point"}};j.extend(e,i,{_init:function(){var a=this.get("node");this.set("dragNode",a);a.on("mousedown",this._handleMouseDown,this)},destroy:function(){var a=this.get("dragNode"),h=this.get("handlers");g(h,function(c){c.css("cursor","auto")});a.detach("mousedown",this._handleMouseDown,this);this.detach()},_check:function(a){var h=this.get("handlers"),c=0;g(h,function(f){if(f.contains(a)||f[0]==a[0]){c=1;return false}});return c},
_handleMouseDown:function(a){if(this._check(new n(a.target))){a.preventDefault();this._prepare(a)}},_prepare:function(a){k._start(this);var h=this.get("node"),c=a.pageX;a=a.pageY;h=h.offset();this.startMousePos=this.mousePos={left:c,top:a};this.startNodePos=h;this._diff={left:c-h.left,top:a-h.top}},_move:function(a){var h=this._diff,c=a.pageX-h.left;h=a.pageY-h.top;this.mousePos={left:a.pageX,top:a.pageY};a={left:c,top:h,pageX:a.pageX,pageY:a.pageY,drag:this};this.fire("drag",a);k.fire("drag",a)},
_end:function(){this.fire("dragend",{drag:this});k.fire("dragend",{drag:this})},_start:function(){this.fire("dragstart",{drag:this});k.fire("dragstart",{drag:this})}});return e},{requires:["ua","node","base","./ddm"]});
KISSY.add("dd/droppable",function(j,m,n,i){function k(){k.superclass.constructor.apply(this,arguments);this._init()}k.ATTRS={node:{setter:function(e){if(e)return m.one(e).addClass(i.get("prefixCls")+"drop")}}};j.extend(k,n,{getNodeFromTarget:function(e,g,a){e=this.get("node");var h=e[0];return h==g||h==a?null:e},_init:function(){i._regDrop(this)},_handleOut:function(){var e=i.get("activeDrag"),g={drop:this,drag:e};this.get("node").removeClass(i.get("prefixCls")+"drop-over");this.fire("dropexit",g);
i.fire("dropexit",g);e.get("node").removeClass(i.get("prefixCls")+"drag-over");e.fire("dragexit",g);i.fire("dragexit",g)},_handleOver:function(e){var g=i.get("activeDrop");i.set("activeDrop",this);var a=i.get("activeDrag");this.get("node").addClass(i.get("prefixCls")+"drop-over");e=j.mix({drag:a,drop:this},e);if(this!=g){a.get("node").addClass(i.get("prefixCls")+"drag-over");a.fire("dragenter",e);this.fire("dropenter",e);i.fire("dragenter",e);i.fire("dropenter",e)}else{a.fire("dragover",e);this.fire("dropover",
e);i.fire("dragover",e);i.fire("dropover",e)}},destroy:function(){i._unregDrop(this)}});return k},{requires:["node","base","./ddm"]});
KISSY.add("dd/proxy",function(j,m){function n(){n.superclass.constructor.apply(this,arguments);this[i]={}}var i="__proxy_destructors",k=j.stamp,e=j.guid("__dd_proxy"),g="__proxy";n.ATTRS={node:{value:function(a){return new m(a.get("node").clone(true))}},destroyOnEnd:{value:false}};j.extend(n,j.Base,{attach:function(a){function h(){var d=f.get("node"),l=a.get("node");if(!f[g]&&j.isFunction(d)){d=d(a);d.addClass("ks-dd-proxy");d.css("position","absolute");f[g]=d}l.parent().append(d);d.show();d.offset(l.offset());
a.set("dragNode",l);a.set("node",d)}function c(){var d=f[g];a.get("dragNode").offset(d.offset());d.hide();if(f.get("destroyOnEnd")){d.remove();f[g]=0}a.set("node",a.get("dragNode"))}var f=this,b;if(!(b=k(a,1,e)&&f[i][b])){a.on("dragstart",h);a.on("dragend",c);b=k(a,0,e);f[i][b]={drag:a,fn:function(){a.detach("dragstart",h);a.detach("dragend",c)}}}},unAttach:function(a){a=k(a,1,e);var h=this[i];if(a&&h[a]){h[a].fn();delete h[a]}},destroy:function(){var a=this.get("node"),h=this[i];a&&!j.isFunction(a)&&
a.remove();for(var c in h)this.unAttach(h[c].drag)}});return n},{requires:["node"]});
KISSY.add("dd/draggable-delegate",function(j,m,n,i,k){function e(){e.superclass.constructor.apply(this,arguments)}j.extend(e,n,{_init:function(){this.get("container").on("mousedown",this._handleMouseDown,this)},_getHandler:function(g){for(var a,h=this.get("container"),c=this.get("handlers");g&&g[0]!==h[0];){j.each(c,function(f){if(i.test(g[0],f)){a=g;return false}});if(a)break;g=g.parent()}return a},_getNode:function(g){return g.closest(this.get("selector"),this.get("container"))},_handleMouseDown:function(g){var a;
a=this.get("handlers");var h=new k(g.target);if(a=(a=a.length?this._getHandler(h):h)&&this._getNode(a)){g.preventDefault();this.set("node",a);this.set("dragNode",a);this._prepare(g)}},destroy:function(){this.get("container").detach("mousedown",this._handleMouseDown,this);this.detach()}},{ATTRS:{container:{setter:function(g){return k.one(g)}},selector:{},handlers:{value:[],getter:0}}});return e},{requires:["./ddm","./draggable","dom","node"]});
KISSY.add("dd/droppable-delegate",function(j,m,n,i,k){function e(){e.superclass.constructor.apply(this,arguments)}j.extend(e,n,{getNodeFromTarget:function(g,a,h){var c={left:g.pageX,top:g.pageY},f=this;g=f.get("container");var b=f.get("selector"),d=0;g.all(b).each(function(l){var s=l[0];if(!(s==h||s==a))if(m.inRegion(m.region(l),c)){f.set("lastNode",f.get("node"));f.set("node",d=l);return false}});return d},_handleOut:function(){e.superclass._handleOut.apply(this,arguments);this.set("node",0);this.set("lastNode",
0)},_handleOver:function(g){var a=m.get("activeDrag"),h=m.get("activeDrop"),c=j.mix({drag:a,drop:this},g),f=this.get("node"),b=this.get("lastNode");m.set("activeDrop",this);f.addClass(m.get("prefixCls")+"drop-over");if(this!=h||!b||b&&b[0]!==f[0]){if(b){this.set("node",b);e.superclass._handleOut.apply(this,arguments)}this.set("node",f);a.get("node").addClass(m.get("prefixCls")+"drag-over");a.fire("dragenter",c);this.fire("dropenter",c);m.fire("dragenter",c);m.fire("dropenter",c)}else{a.fire("dragover",
c);this.fire("dropover",c);m.fire("dragover",c);m.fire("dropover",c)}}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(g){return k.one(g)}}}});return e},{requires:["./ddm","./droppable","dom","node"]});
KISSY.add("dd/scroll",function(j,m,n,i){function k(){k.superclass.constructor.apply(this,arguments);this[a]={}}var e=j.stamp,g=100,a="__dd_scrolls";k.ATTRS={node:{valueFn:function(){return n.one(window)},setter:function(c){return n.one(c)}},rate:{value:[10,10]},diff:{value:[20,20]}};var h=j.isWindow;j.extend(k,m,{getRegion:function(c){return h(c[0])?{width:i.viewportWidth(),height:i.viewportHeight()}:{width:c.outerWidth(),height:c.outerHeight()}},getOffset:function(c){return h(c[0])?{left:i.scrollLeft(),
top:i.scrollTop()}:c.offset()},getScroll:function(c){return{left:c.scrollLeft(),top:c.scrollTop()}},setScroll:function(c,f){c.scrollLeft(f.left);c.scrollTop(f.top)},unAttach:function(c){var f,b=this[a];if((f=e(c,1,"__dd-scroll-id-"))&&b[f]){b[f].fn();delete b[f]}},destroy:function(){var c=this[a],f;for(f in c)this.unAttach(c[f].drag)},attach:function(c){function f(r){if(!r.fake){var x=l.get("node");w=r;p=j.clone(c.mousePos);r=l.getOffset(x);p.left-=r.left;p.top-=r.top;o||d()}}function b(){clearTimeout(o);
o=null}function d(){var r=l.get("node"),x=l.getRegion(r),A=x.width;x=x.height;var t=l.getScroll(r),z=j.clone(t),y=false;if(p.top-x>=-u[1]){t.top+=v[1];y=true}if(p.top<=u[1]){t.top-=v[1];y=true}if(p.left-A>=-u[0]){t.left+=v[0];y=true}if(p.left<=u[0]){t.left-=v[0];y=true}if(y){l.setScroll(r,t);o=setTimeout(d,g);w.fake=true;if(h(r[0])){t=l.getScroll(r);w.left+=t.left-z.left;w.top+=t.top-z.top}c.fire("drag",w)}else o=null}var l=this,s=e(c,0,"__dd-scroll-id-"),q=l[a];if(!q[s]){var v=l.get("rate"),u=l.get("diff"),
w,p,o=null;c.on("drag",f);c.on("dragend",b);q[s]={drag:c,fn:function(){c.detach("drag",f);c.detach("dragend",b)}}}}});return k},{requires:["base","node","dom"]});KISSY.add("dd",function(j,m,n,i,k,e,g,a){m={Draggable:n,Droppable:i,DDM:m,Proxy:k,DraggableDelegate:e,DroppableDelegate:g,Scroll:a};j.mix(j,m);return m},{requires:["dd/ddm","dd/draggable","dd/droppable","dd/proxy","dd/draggable-delegate","dd/droppable-delegate","dd/scroll"]});
